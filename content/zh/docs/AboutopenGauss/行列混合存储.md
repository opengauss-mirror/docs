# 行列混合存储

## 可获得性<a name="section18007590"></a>

本特性自openGauss 1.0.0版本开始引入。

## 特性简介<a name="section27850590"></a>

openGauss支持行存储和列存储两种存储模型，用户可以根据具体的使用场景，建表时选择行存储还是列存储表。

一般情况下，如果表的字段比较多（即大宽表），查询中涉及到列不很多的情况下，适合列存储。列存储方式如[图1](#fig114741818102620)所示。如果表的字段个数比较少，查询大部分字段，那么选择行存储比较好。

**图 1**  列存储示意图<a name="fig114741818102620"></a>  


![](figures/mixed-storage-engine.png)


## 客户价值<a name="section49328722"></a>

在大宽表、数据量比较大的场景中，查询经常关注某些列，行存储引擎查询性能比较差。例如，气象局的场景，单表有200\~800个列，查询经常访问10个列，在类似这样的场景下，向量化执行技术和列存储引擎可以极大的提升性能和减少存储空间。

## 特性描述<a name="section41305314"></a>

表有行存表和列存表两种存储模型。两种存储模型各有优劣，建议根据实际情况选择。使用方法请参考[规划存储模型](../DeveloperGuide/规划存储模型.md)。

-   行存表

    默认创建表的类型。数据按行进行存储，即一行数据紧挨着存储。行存表支持完整的增删改查。适用于对数据需要经常更新的场景。

- 列存表

    数据按列进行存储，即一列所有数据紧挨着存储。单列查询IO小，比行存表占用更少的存储空间。适合数据批量插入、更新较少和以查询为主统计分析类的场景。列存表不适合点查询，insert插入单条记录性能差。

- 行存表和列存表的选择依据如下：

   - 更新频繁程度

     数据如果频繁更新，选择行存表。

   - 插入频繁程度

     频繁的少量插入，选择行存表。一次插入大批量数据，选择列存表。

   - 表的列数

     表的列数很多，选择列存表。

   - 查询的列数

     如果每次查询时，只涉及了表的少数（小于总列数的50%）几个列，选择列存表。

   - 压缩率

     列存表比行存表压缩率高。但高压缩率会消耗更多的CPU资源。



## 特性增强<a name="section36203513"></a>

无。

## 特性约束<a name="section06531946143616"></a>

列存的规格约束如下：

-   表
    -   不支持全局临时表。
    -   不支持继承表。
    -   不支持create table of typename。
    -   不支持二级分区。
    -   列存仅支持范围分区。
    -   支持的分布表类型：REPLICATION分布、RANGE分布、LIST分布、HASH分布。

-   索引

    支持索引的类型：psort、btree、gin。

-   SQL语法
    -   insert/update/delete returning语句不支持。
    -   rownum、start with connect by采用了转换成行存支持实现。

-   存储过程

    列存cursor不支持BACKWARD、PRIOR等涉及反向获取操作。

-   数据类型。支持以下基础类型及对应的数组类型：
    -   数值类型：TINYINT SMALLINT INTEGER BIGINT OID REAL DOUBLE NUMERIC。
    -   布尔类型：BOOLEAN。
    -   字符类型：CHAR\(n\) VARCHAR\(n\) NVARCHAR2\(n\) TEXT CLOB。
    -   日期/时间类型：DATE TIME TIMESTAMP SMALLDATETIME INTERVAL tinterval reltime abstime。
    -   网络地址类型：CIDR INET。
    -   货币类型：MONEY。
    -   位串类型：BIT\(n\) BIT VARYING\(n\)。
    -   HLL数据类型：HLL HLL\_HASHVAL。
    -   二进制类型：BYTEA BYTEAWITHOUTORDERCOL BYTEAWITHOUTORDERWITHEQUALCOL。
    -   其他类型（包括自定义类型）均不支持。

-   存储&事务
    -   不支持闪回。
    -   不支持逻辑解码。
    -   不支持PITR。
    -   不支持发布订阅。
    -   不支持回收站。
    -   不支持段页式管理。
    -   不支持极致RTO。
    -   不支持并发更新同一行。
    -   不支持主备页面和文件自动修复。

-   其他
    -   不支持透明加密（TDE）。
    -   列存表目前只支持rank和row\_number两个函数（其他窗口函数会先转换成行存再处理）。
    -   不支持增量物化视图。
    -   不支持虚拟索引
    -   Delta表不支持索引。

## 依赖关系<a name="section57396167"></a>

无。

