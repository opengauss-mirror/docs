# gs_probackup适配资源池化

## 可获得性<a name="section15406143204715"></a>

本特性自openGauss 6.0.0-RC1版本开始引入。

## 特性简介<a name="section740615433477"></a>

本特性实现了资源池化场景下适配gs_probackup工具，包括支持全量备份、增量备份、合并、删除、恢复、验证等功能。

## 客户价值<a name="section13406743164715"></a>

gs_probackup适配资源池化后，在资源池化场景下可实现数据库备份、恢复等功能。

## 特性描述<a name="section16406154310471"></a>

gs_probackup的主要功能如下:

-   备份：gs_probackup工具采用物理备份的方式进行备份，支持全量备份、增量备份等备份方式，并且支持备份压缩。对数据库进行备份，可以增强数据库的抗风险能力。
-   恢复：gs_probackup工具支持全量恢复与增量恢复，提供将数据库恢复到之前状态的能力。gs_probackup工具提供的恢复能力，是数据库安全可靠的重要保证。
-   验证：gs_probackup提供了验证备份完整性和一致性的功能，确保备份数据的可靠性。

除了以上的主要功能之外，gs_probackup工具还具有备份合并、备份管理等功能。

## 特性增强<a name="section1340684315478"></a>

本特性扩展了gs_probackup工具的使用场景，使其在资源池化场景下也能使用。

## 特性约束<a name="section06531946143616"></a>

-   可以正常连接openGauss数据库。
-   恢复时需要确保ulimit -s参数的值不小于8192。

## 依赖关系<a name="section8406643144716"></a>

本特性依赖资源池化磁阵设备。

## 基本原理
‌数据库备份的原理是通过将数据库中的数据和元数据复制到另一个存储位置，以便在原始数据库发生故障或数据丢失时，能够恢复数据库到之前的状态。‌数据库备份可以分为物理备份和逻辑备份两种方式；
-   物理备份：  
物理备份基于数据库的二进制文件，直接复制数据库文件。这种方式备份速度快，恢复也快。通过操作系统的文件复制命令或磁盘镜像工具将数据库文件直接复制到备份存储位置
-   逻辑备份：  
逻辑备份基于数据库的逻辑结构，通过导出数据和表结构的方式进行备份。这种方式速度相对较慢，但备份文件较小，更加灵活。将数据库中的数据和表结构以SQL语句的形式导出到备份文件中，可以通过数据库管理工具或命令行工具进行导出操作  

openGauss产品在备份基础上实现了三种功能，分别是增量备份、备份合并和增量恢复： 
-   增量备份原理：  
1.  修改xlog文件备份路径，会通过-B参数将文件备份到指定的backup_path/instance/database/pg_xlog0目录下。  
2.  通过修改cbmparesexlog解析文件来读取的xlog文件路径。  
3.  pgBackup结构体新增成员变量dssdata_bytes，用于在备份开始时体现PGDATA与DSSDATA中的文件大小。
-   备份合并原理：  
1.  资源池化模式下，备份合并后的的dss文件保存将在backup_path/instance/dssdata目录下。
2.  在备份合并与恢复时会使用一些相同的函数，新增参数区分两者区别。
3.  在涉及到外目录文件，合并时会报错，进行对应修改。  
-   增量恢复原理：
1.  在增量恢复时，PGDATA目录与+data目录可以不为空。
2.  修改部分变量名，新增分支判断，资源池化与非资源池化模式下不同路径。
3.  在移除冗余文件时，不移除其他节点的文件。
4.  在增量恢复时禁用预写功能。

## 使用指导

参考[gs_probackup工具](../ToolandCommandReference/gs_probackup.md)使用指导。

## 使用场景
实现资源池化场模式，一主多备场景下的增量备份，全量备份，恢复，验证等功能。






