# 主备机

## 可获得性<a name="section14707931165614"></a>

本特性自openGauss 1.0.0 版本开始支持DN主备。

## 特性简介<a name="section93301955145613"></a>

为了保证故障的可恢复，需要将数据写多份，设置主备多个副本，通过日志进行数据同步，可以实现节点故障、停止后重启等情况下，openGauss能够保证故障之前的数据无丢失，满足ACID特性。

## 客户价值<a name="section196071875710"></a>

主备机功能可以支持主机故障时切换到备机，数据不丢失，业务可以快速恢复。

## 特性描述<a name="section138621058175717"></a>

主备环境支持一主多备模式。在一主多备模式下，所有的备机都需要重做日志，都可以升主。一主多备提供更高的容灾能力，更加适合于大批量事务处理的OLTP系统。

主备之间可以通过switchover进行角色切换，主机故障后可以通过failover对备机进行升主。

初始化安装或者备份恢复等场景中，需要根据主机重建备机的数据，此时需要build功能，将主机的数据和WAL日志发送到备机。主机故障后重新以备机的角色加入时，也需要build功能将其数据和日志与新主拉齐。另外，在在线扩容的场景中，需要通过build来同步元数据到新节点上的实例。Build包含全量build和增量build，全量build要全部依赖主机数据进行重建，拷贝的数据量比较大，耗时比较长，而增量build只拷贝差异文件，拷贝的数据量比较小，耗时比较短。一般情况下，优先选择增量build来进行故障恢复，如果增量build失败，再继续执行全量build，直至故障恢复。

为了实现所有实例的高可用容灾能力，除了以上对DN设置主备多个副本，openGauss还提供了其他一些主备容灾能力，比如CM Server（一主多备）以及ETCD（一主多备）等，使得实例故障后可以尽可能快地恢复，不中断业务，将因为硬件、软件和人为造成的故障对业务的影响降到最低，以保证业务的连续性。

## 特性增强<a name="section437573965810"></a>

无。

## 特性约束<a name="section1956417145819"></a>

无。

## 依赖关系<a name="section15876411599"></a>

无。

