# cm支持双集群备集群switchover

## 可获得性<a name="section15406143204715"></a>

本特性自openGauss 6.0.0版本开始引入。

## 特性简介<a name="section740615433477"></a>

增强CM的集群管理功能，通过该特性可以实现资源池化双集群的备集群首备切换能力。

## 客户价值<a name="section13406743164715"></a>

提升对于资源池化双集群备集群的管理能力。

## 特性描述<a name="section16406154310471"></a>

CM支持双集群中备集群首备和从备的switchover，保证切换后和主集群建联、日志同步状态正常。

## 特性增强<a name="section1340684315478"></a>

无。

## 特性约束<a name="section06531946143616"></a>

-   原首备与升首备节点状态正常。
-   尽量避免在大量业务情况下执行切换。
-   主备集群间的容灾关系正常，无网络及其他异常。

## 依赖关系<a name="section8406643144716"></a>

无。

## 基本原理<a name="section8406461564716"></a>

通过CM的客户端工具cm_ctl向cm_server发送switchover消息，cm_server收到消息后会向对应节点的cm_agent下发仲裁命令，再由cm_agent执行gs_ctl switchover使对应节点切换为备集群首备。在超时时间内，cm_ctl会一直向cm_server获取节点状态，通过获取到的状态判断是否切换成功，并在前端返回对应的结果。在switchover执行期间，cm_server会暂停集群的部分仲裁，保证不会因仲裁导致切换失败。切换成功之后，新首备会主动向主集群建立连接，且从备主动连接首备，保证主备集群间容灾状态正常、备集群中首备从备连接正常。

## 使用指导<a name="section8445461564354"></a>

与单集群切换命令保持一致，参考[cm\_ctl工具介绍](../ToolandCommandReference/cm_ctl工具介绍.md)。

## 使用场景<a name="section8445461564132"></a>

在实际生产环境中，对主节点或者备集群首备直接进行操作通常存在一定的风险，严重情况下会导致集群不可用。这个时候就可以使用该特性进行切换，便于管理且减少使用风险。如更换节点ip、更换节点名等变更场景下，为了不影响集群业务，对主节点或首备节点进行操作时，需要通过switchover命令将其切换为备节点，之后再进行对应操作。