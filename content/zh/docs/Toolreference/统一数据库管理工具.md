# 统一数据库管理工具<a name="ZH-CN_TOPIC_0000001246286999"></a>

CM（Cluster Manager）是一款数据库管理模块。支持自定义资源监控，提供了数据库主备的状态监控、网络通信故障监控、文件系统故障监控、故障自动主备切换等能力。提供了丰富的数据库管理能力，如节点、实例级的启停，数据库实例状态查询、主备切换、日志管理等。提供了通过REST接口远程查询和接收集群状态的能力。

需要注意的是，一主一备模式下，CM只支持基本的安装，启停，检测能力，其他功能不支持。

-   **[特性介绍](#ZH-CN_TOPIC_0000001201007180)**  

-   **[cm\_ctl工具介绍](#ZH-CN_TOPIC_0000001201327140)**  

-   **[安装和卸载工具介绍](#ZH-CN_TOPIC_0000001201210100)**  

-   **[安全设计](#ZH-CN_TOPIC_0000001201487108)**  

-   **[CM配置参数介绍](#ZH-CN_TOPIC_0000001201167154)**  

## 特性介绍<a name="ZH-CN_TOPIC_0000001201007180"></a>

### cm\_agent<a name="section1669543664312"></a>

cm\_agent是部署在数据库每个主机上，用来启停和监控各个数据库实例进程的数据库管理组件。

主要功能有：

-   数据库实例启动和停止时负责拉起和停止本主机上部署的实例进程。
-   监控本主机上运行的实例状态并将状态上报发送给CM Server。
-   执行CM Server仲裁下发的命令。

**命令说明**：

- 公共选项：

  - -V, --version

    打印cm\_agent版本信息，然后退出。

  - -?, -h,--help

    显示关于cm\_agent命令行参数的帮助信息，然后退出。


- 日志信息记录的位置选项：

  - 0

    记录在设定的日志文件中。

  - 1

    记录在syslog文件中。

  - 2

    记录在设定的日志文件中。

  - 3

    空文件，即不记录日志信息。


- 启动模式选项：

  - normal

    正常模式启动。

  - abnormal

    非正常模式启动。



### cm\_server<a name="section132815414420"></a>

cm\_server是用来进行数据库实例管理和实例仲裁的组件。主要功能有：

-   接收各个节点上cm\_agent发送的数据库各实例状态。
-   提供数据库实例整体状态的查询功能。
-   监控实例的状态变化并进行仲裁命令的下发。

**命令说明**：

- 公共选项：

  - -V, --version

    打印cm\_server版本信息，然后退出。

  - -?, -h,--help

    显示关于cm\_server命令行参数的帮助信息，然后退出。


- 日志信息记录的位置选项：

  - 0

    记录在设定的日志文件中。

  - 1

    记录在syslog文件中。

  - 2

    记录在设定的日志文件中。

  - 3

    空文件，即不记录日志信息。

### 支持自定义资源监控

当前CM支持对无状态资源（即各资源实例角色平等，不区分主备，或资源自身就能够自行进行主备仲裁）进行监控，主要功能包括：
-   资源启动、停止
-   资源进程监控、异常拉起
-   查询资源进程状态
-   进程僵死检测和恢复（需结合资源脚本）

配置方法：
安装好自定义资源后，若要使用自定义资源监控功能，需要配置两个文件：

1. 资源脚本  
主要用于指定资源的启停、状态检查等指令，一个样例如下：
```
#!/bin/bash
#set -ex   #取消该行注释可帮助调试脚本
#资源名称
resName=sharding
#资源binpath
shardingPath=/home/test/home/apache-shardingsphere-5.1.1-shardingsphere-proxy-bin/bin
#用于过滤资源实例的命令关键词
cmdKey=org.apache.shardingsphere.proxy.Bootstrap
#用于保存首次检测到资源僵死时间的文件
phony_dead_time_file=.sharding_phony_dead_time
#最长僵死时间，单位为s
PHONY_MAX_TIME=20

function exec_start
{
  #资源启动命令
  sh ${shardingPath}/start.sh; exit $?
}

function exec_stop
{
  #资源停止命令
  sh ${shardingPath}/stop.sh; exit $?
}

function exec_check
{
  #查询资源实例pid
  pid=`ps x | grep "$cmdKey" | grep -v grep | awk '{print $1}'`
  if [ "${pid}" == "" ]; then
    echo "$resName is not running."
    exit 1
  fi
  #查询资源实例进程状态
  state=`cat /proc/$pid/status | grep "State" | awk '{print $2}'`
  if [ "$state" == "T" ]; then
    #僵死检查和处理
    if [ ! -f $phony_dead_time_file ]; then
      touch ./${phony_dead_time_file}
      echo "export firstphonytime=''" > ./${phony_dead_time_file}
    fi
    source ./$phony_dead_time_file;
    curtime=$(date +%s);
    if [ "$firstphonytime" == "" ]; then
      #首次检测到资源僵死，将首次检测到僵死的时间写入僵死时间存储文件
      #firstphonytime为用于保存当前资源实例僵死时间的变量名称，
      #若当前节点存在多个自定义资源实例，该名称需要指定为不同的名称
      echo "export firstphonytime=$curtime" > ./$phony_dead_time_file;
      exit 0;
    fi
    dead_time=$(( $curtime - $firstphonytime ));
    #若僵死时间大于等于用户设定的最大僵死时间，则立即杀死资源实例，否则不做处理正常退出
    if [ $dead_time -ge $PHONY_MAX_TIME ]; then
      echo "$resName is detected in a state of phony dead(T) and will be forcibly killed!"
      kill -9 $pid
      rm ./${phony_dead_time_file} -f
      sh ${shardingPath}/start.sh; exit $?
    else
      exit 0
    fi
  elif [ "$state" == "S" ]; then
    #未处于僵死状态清理环境后正常退出
    rm ./${phony_dead_time_file} -f
    exit 0
  fi
}

#以下为固定接口无需更改，对应以上三个函数，且必须实现
if [ $1 == '-start' ]; then
  exec_start $2
elif [ $1 == '-stop' ]; then
    exec_stop $2
elif [ $1 == '-check' ]; then
  exec_check $2
fi
```
以上样例可以作为模板使用，用户主要需要修改的地方包括：
资源名称、资源binPath、用于过滤资源实例的命令关键词、用于保存首次检测到资源僵死时间的文件（可选）、最长僵死时间、记录首次僵死时间的变量名（如果同一节点存在多个不同的自定义资源实例）

2. 自定义资源配置文件cm_resource.json
该文件位置为cmdir/cm_agent/cm_resource.json，配置该文件后需要重启集群
```
{
  "resources": [
    {
      "name": "sharding",
      "instances": [
        {
          "node_id": 1,
          "res_instance_id": 1
        },
        {
          "node_id": 2,
          "res_instance_id": 2
        }
      ],
      "script": "/usr2/omm/install/cm/cm_agent/sharding.sh",
      "check_interval": 1,
      "time_out": 5,
      "restart_delay":3,
      "restart_period":5,
      "restart_times":10
    },
    {
      "name": "test",
      "instances": [
        {
          "node_id": 1,
          "res_instance_id": 1
        },
        {
          "node_id": 2,
          "res_instance_id": 2
        }
      ],
      "script": "/usr2/omm/install/cm/cm_agent/test.sh",
      "check_interval": 1,
      "time_out": 5,
      "restart_delay":0,
      "restart_period":0,
      "restart_times":1000
    }
  ]
}
```
配置说明：  
-   resources: 自定义资源对象列表，名称固定不能更改
-   name: 自定义资源对象名称，字符串类型，最大长度为32（包含末尾'\0'）
-   instances: 自定义资源所在节点列表
-   node_id: 资源实例所在节点的node_id
-   res_instance_id: 资源实例id，大于等于0，同一种资源的不同实例id不同
-   script: 资源脚本位置
-   check_interval: 上报资源状态时间间隔，大于等于0，单位s
-   time_out: 脚本执行的超时时间，大于等于0，单位s
-   restart_delay: 故障之后重启延迟时间，单位为s，取值范围[0,1800]
-   restart_period: 当前时间-最近重启时间若大于restart_period，则再次重启资源重启次数加1
-   restart_times: 周期内最多重启次数，超过则不再重启，并将资源标记为不可用，取值范围[0,9999]，0表示无限重启

>![](public_sys-resources/icon-caution.gif) **注意：**   
>资源配置文件需要在所有节点上都有，且保持一致  
>用户需要保证资源脚本能够正确运行  


### 支持集群信息查询和推送
**功能介绍：**  
通过运行组件CMRestAPI，CM能够支持：

1. 通过http/https服务远程查询到集群的状态，便于管理人员、运维平台等监控集群状态
2. 在数据库集群发生切主事件时，通过http/https服务及时地将集群最新的主备信息推送到应用端注册的接收地址，便于应用端及时的感知到集群的主备变化，从而能够快速的连接到新的主机和备机。

**参数说明：**  
-e 数据库环境变量文件，必须指定  
-w 访问来源ip白名单，如果不需要设置白名单则可以不用指定  
启动命令：  
java -jar cmrestapi-xxx.jar -e envFile [-w appWhiteList]

**接口说明：**  
1. 集群或节点状态查询  
该接口使用GET方法，链接为http://ip:port/CMRestAPI/keyword  
其中：  
ip为运行CMRestAPI的节点ip；  
port为CMRestAPI服务的监听端口；  
keyword为待查询的信息关键词，当前支持查询的信息即关键词包括：  
集群状态**ClusterStatus**，对应链接为**http://ip:port/CMRestAPI/ClusterStatus**  
节点状态**NodeStatus**，对应链接为**http://ip:port/CMRestAPI/NodeStatus[?nodeId=n]**， 指定nodeId等于n，则可以查询节点n的状态，若不指定nodeId，则默认返回提供服务的节点即链接中ip所指定节点的状态。  

2. 注册和更新主备机信息接收地址  
如果应用端想要接收到CMRestAPI推送的集群当前最新的主备信息，需要向CMRestAPI注册一个信息接收地址并且需要在该地址上进行监听。接收到该请求后CMRestAPI会通过dcc将注册的接收地址保存到集群所在环境，dcc存储数据的形式为key-value形式，使用的key为/CMRestAPI/RecvAddrList/**ip**/**app**，其中ip为应用端所在机器的ip地址，app为用户自定义的应用名称，主要用于区分同一环境上的多个应用注册的接收地址。如果key已存在，即来源ip和应用名称均相同，则会更新key对应的主备信息接收地址。  
该接口需使用PUT方法，链接为http://ip:port/CMRestAPI/RecvAddr， 需要提供两个参数：  
url——待注册的接收地址；  
app——应用名称，若不提供该参数则以**前缀+应用端ip**为key。

3. 删除主备机信息接收地址  
该接口使用DELETE方法，链接为http://ip:port/CMRestAPI/RecvAddr， 需要提供一个参数：  
app——应用名称。若不提供该参数则以**前缀+应用端ip**为key。  

4. 信息接收地址说明  
信息接收地址示例：http://ip:port/CMRestAPI ,
CMRestAPI使用PUT方法，推送主机信息context为MasterInfo，即链接为http://ip:port/CMRestAPI/MasterInfo， 发送对象类型为String，主机信息格式为ip:port，推送备机context为StanbyInfo，发送对象类型为String，备机信息格式为ip1:port1,ip2:port2,...,ipn:portn，一个应用端的demo参见CMRestAPI仓库中的applicationdemo，https://gitee.com/opengauss/CM-RestAPI/tree/master/applicationdemo/src/main/java/com/application/applicationdemo。

**其他使用说明：**  
1. 安全相关  
(1) CMRestAPI默认使用http服务，支持配置访问白名单，可通过启动参数-w配置访问来源ip的白名单文件，白名单文件配置格式为每行一个ip地址；  
(2) 若要使用https服务，则可以在启动时jar包时指定系统参数server.ssl相关参数来是CMRestAPI启动https服务，或将相关参数写入application.properties文件然后在启动命令中指定配置文件，或配置源码resource目录下的application.properties文件然后自行编译，自定义配置参数示例：  
```
-Dserver.port=服务监听端口 -Dserver.ssl.key-store=秘钥文件路径 -Dserver.ssl.key-store-password=秘钥文件密码 -Dserver.ssl.key-store-type=秘钥类型  
如：  
指定参数方式系统参数方式
java -jar -Dserver.port=8443 -Dserver.ssl.key-store=/home/omm/keystore.p12 -Dserver.ssl.key-store-password=Abcdef@123 -Dserver.ssl.key-store-type=PKCS12 cmrestapi-xxx.jar -e envFile  
指定配置文件方式  
java -jar -Dspring.config.location=/configpath/application.properties cmrestapi-xxx.jar -e envFile
```
更多相关配置参数可自行搜索配置

2. 内存相关  
由于本程序使用了springboot框架，默认启动会占用较大内存（约1G左右），若并发量不大不希望该程序占用较大内存，则可以在启动时指定一些系统参数减小内存占用，启动参数示例：  
```
-XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=56m -Xms128m -Xmx128m -Xmn32m -Xss328k -XX:SurvivorRatio=8 -XX:+UseConcMarkSweepGC  
如：java -jar -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=56m -Xms128m -Xmx128m -Xmn32m -Xss328k -XX:SurvivorRatio=8 -XX:+UseConcMarkSweepGC cmrestapi-xxx.jar -e envFile
```
更多相关配置参数可自行搜索配置

3. 自定义资源配置文件  
本程序需要依赖cm相关进程和指令，所以必须与cm同时运行，需配置自定义资源配置文件，配置方法详见自定义资源监控特性相关内容。

**操作步骤说明：**  
1. 安装带cm的数据库集群，配置资源脚本和自定义资源文件，资源脚本示例如下：  
cmrestapi.sh
```
#!/bin/bash
#set -ex
#资源名称
resName=CM-RestAPI
#资源binpath
cmrestapiPath=/home/cmrestapi/cmrestapi-3.1.0-RELEASE.jar
#资源启动命令关键词
cmdKey=cmrestapi-3.1.0-RELEASE.jar
#用于保存首次检测到资源假死时间的文件
phony_dead_time_file=.cmrestapi_phony_dead_time
#最长假死时间，单位为s
PHONY_MAX_TIME=20
envFile=/home/cmrestapi/envfile
#appWhiteListFile=/home/cmrestapi/appWhiteListFile
source $envFile

function exec_start
{
    nohup java -jar -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=56m -Xms128m -Xmx128m -Xmn32m -Xss328k -XX:SurvivorRatio=8 -XX:+UseConcMarkSweepGC -Dserver.port=8080 $cmrestapiPath -e $envFile >> $GAUSSLOG/cm/cmrestapi/cmrestapi.log 2>&1 &
    exit $?
}

function exec_stop
{
    ps x | grep "$cmdKey" | grep -v grep | awk '{print $1}' | xargs kill -9; exit $?
}

function exec_check
{
    pid=`ps x | grep "$cmdKey" | grep -v grep | awk '{print $1}'`
    if [ "${pid}" == "" ]; then
        echo "$resName is not running."
        exit 1
    fi
    state=`cat /proc/$pid/status | grep "State" | awk '{print $2}'`
    if [ "$state" == "T" ]; then
        if [ ! -f $phony_dead_time_file ]; then
            touch ./${phony_dead_time_file}
            echo "export firstphonytime=''" > ./${phony_dead_time_file}
        fi
        source ./$phony_dead_time_file;
        curtime=$(date +%s);
        if [ "$firstphonytime" == "" ]; then
            echo "export firstphonytime=$curtime" > ./$phony_dead_time_file;
            exit 0;
        fi
        dead_time=$(( $curtime - $firstphonytime ));
        if [ $dead_time -ge $PHONY_MAX_TIME ]; then
            echo "$resName is detected in a state of phony dead(T) and will be forcibly killed!"
            kill -9 $pid
            rm ./${phony_dead_time_file} -f
            exec_start
        else
            exit 0
        fi
    elif [ "$state" == "S" ]; then
        rm ./${phony_dead_time_file} -f
        echo "$resName is running normally."
        exit 0
    fi
}

if [ $1 == '-start' ]; then
    exec_start $2
elif [ $1 == '-stop' ]; then
    exec_stop $2
elif [ $1 == '-check' ]; then
    exec_check $2
fi
```
自定义资源文件cm_resource.json示例如下：  
```
{
  "resources": [
    {
      "name": "CM-RestAPI",
      "instances": [
        {
          "node_id": 1,
          "res_instance_id": 1
        },
        {
          "node_id": 2,
          "res_instance_id": 2
        },
        {
          "node_id": 3,
          "res_instance_id": 3
        }
      ],
      "script": "/home/cmrestapi/install/cm/cm_agent/cmrestapi.sh",
      "check_interval": 1,
      "time_out": 10,
      "restart_delay":0,
      "restart_period":0,
      "restart_times":1000
    }
  ]
}
```
>![](public_sys-resources/icon-caution.gif) **注意：**   
>使用cm的自定义资源管理功能需将进程放到后台执行，所以需要将日志输出重定向至日志文件或配置日志输出相关选项，并且使用nohup和&将本程序放置到后台运行
>本程序需要运行在有数据库的节点；如果在集群发生切换时需要使用主备信息主动推送功能，则需要将该程序运行在集群中所有数据库节点

2. 启动集群，即可通过浏览器等访问上述集群或节点信息查询接口查询对应信息
3. 应用端开发（可参考源码仓库的demo），启动应用端
4. 注册信息接收地址


## cm\_ctl工具介绍<a name="ZH-CN_TOPIC_0000001201327140"></a>

cm\_ctl是openGauss提供的用来控制数据库实例服务的工具。该工具主要供OM调用，及数据库实例服务自恢复时使用。cm\_ctl的主要功能有：

-   启动数据库实例服务、AZ的所有实例、单个主机上的所有实例或单独启动某个实例进程。
-   停止数据库实例服务、AZ的所有实例、单个主机上的所有实例或单独停止某个节点实例进程。
-   重启逻辑数据库实例服务。
-   查询数据库实例状态或者单个主机的状态。
-   切换主备实例或重置实例状态。
-   重建备机。
-   查看数据库实例配置文件。
-   设置日志级别，一主多备数据库实例部署下cm\_server的仲裁模式、AZ之间的切换模式。
-   获取日志级别，一主多备数据库实例部署下cm\_server的仲裁模式、AZ之间的切换模式。
-   检测实例进程状态。

与cm\_ctl工具相关的文件：

- cluster\_manual\_start

  该文件是数据库实例启停标志文件。文件位于_$GAUSSHOME/bin_下。其中，GAUSSHOME为环境变量。启动数据库实例时，cm\_ctl会删除该文件；停止数据库实例时，cm\_ctl会生成该文件，并向文件写入停止模式。


- instance\_manual\_start\_X（X是实例编号）

  该文件是单个实例启停标志文件。文件位于_$GAUSSHOME/bin_下。其中，GAUSSHOME为环境变量。启动实例时，cm\_ctl会删除该文件；停止实例时，cm\_ctl会生成该文件，并向文件写入停止模式。


cm\_ctl的相关约束：

-   在集群模式下，使用cm\_ctl集群工具来切换数据库角色，而不是gs\_ctl数据库工具。

### 命令说明<a name="zh-cn_topic_0116784021_s03ab48c805584dbda0f4d8f1a36833c2"></a>

cm\_ctl参数可分为如下几类：

-   option参数，详细请参见  [表 option参数](#zh-cn_topic_0116784021_table1718281376)。
-   公共参数，详细请参见  [表 公共参数](#zh-cn_topic_0116784021_t73f4b6dad11943ea811a211e6c127669)。
-   start模式的参数，详细参见  [表 start参数](#table45722029132319)。
-   switchover模式的参数，详细请参见  [表 switchover参数](#table12226155814102)。
-   build模式的参数，详细请参见  [表 build参数](#table649003761312)。
-   check模式的参数，详细请参见  [表 check参数](#zh-cn_topic_0116784021_t5582631c9b25449da85855fab919ddfd)。
-   stop模式的参数，详细请参见  [表 stop参数](#zh-cn_topic_0116784021_t7507cabe697c4b4da00814fccee8e559)。
-   query模式的参数，详细请参见  [表 query参数](#zh-cn_topic_0116784021_t19badc48929f4f9abd94b8ac774f06c1)。
-   view模式的参数，详细请参见  [表 view参数](#zh-cn_topic_0116784021_table207722104617)。
-   set模式的参数，详细请参见  [表 set参数](#zh-cn_topic_0116784021_tef5e0858a71c4d21abce8f80e3ba7723) [表 set cm参数](#table10437204416514)。
-   get模式的参数，详情请参见  [表 get参数](#table1599151916313)。
-   setrunmode模式的参数，详细请参见  [表 setrunmode参数](#table1656519521713)。
-   changerole模式的参数，详细请参见  [表 changerole参数](#table326418392182)。
-   changemember功能的参数，详细请参见  [表 changemember参数](#table27311655104911)。
-   reload模式的参数，详细请参见  [表 reload 参数](#table11377594818)。
-   list模式的参数，详细请参见  [表 list参数](#table0914920191018)。
-   encrypt模式的参数，详细请参见  [表 encrypt参数](#table4739105911382)。
-   ddb模式的参数，详细请参见  [表 ddb参数](#table9665145942617)。
-   switch模式的参数，详细请参见  [表 switch参数](#table7591811163812)。

使用方法:
```
cm_ctl start [-z AVAILABILITY_ZONE [--cm_arbitration_mode=ARBITRATION_MODE]] | [-n NODEID [-D DATADIR]] [-t SECS]
cm_ctl switchover [-z AVAILABILITY_ZONE] | [-n NODEID -D DATADIR [-f]] | [-a] | [-A] [-t SECS]
cm_ctl finishredo
cm_ctl build [-c] [-n NODEID] [-D DATADIR [-t SECS] [-f] [-b full] [-j NUM]]
cm_ctl check -B BINNAME -T DATAPATH
cm_ctl stop [[-z AVAILABILITY_ZONE] | [-n NODEID [-D DATADIR]]] [-t SECS] [-m SHUTDOWN-MODE]
cm_ctl query [-z ALL] [-l FILENAME] [-v [-C [-s] [-S] [-d] [-i] [-F] [-x] [-p]] | [-r]] [-t SECS] [--minorityAz=AZ_NAME]
cm_ctl view [-v | -N | -n NODEID] [-l FILENAME]
cm_ctl set [--log_level=LOG_LEVEL] [--cm_arbitration_mode=ARBITRATION_MODE] [--cm_switchover_az_mode=SWITCHOVER_AZ_MODE] [--cmsPromoteMode=CMS_PROMOTE_MODE -I INSTANCEID]
cm_ctl set --param --agent | --server [-n [NODEID]] -k [PARAMETER]="[value]"
cm_ctl get [--log_level] [--cm_arbitration_mode] [--cm_switchover_az_mode]
cm_ctl setrunmode -n NODEID -D DATADIR  [[--xmode=normal] | [--xmode=minority --votenum=NUM]]
cm_ctl changerole [--role=PASSIVE | --role=FOLLOWER] -n NODEID -D DATADIR [-t SECS]
cm_ctl changemember [--role=PASSIVE | --role=FOLLOWER] [--group=xx] [--priority=xx] -n NODEID -D DATADIR [-t SECS]
cm_ctl reload --param [--agent | --server]
cm_ctl list --param --agent | --server
cm_ctl encrypt [-M MODE] -D DATADIR
cm_ctl ddb DCC_CMD
cm_ctl switch [--ddb_type=[DDB]] [--commit] [--rollback]
```

**表 1**  option参数

<a name="zh-cn_topic_0116784021_table1718281376"></a>

<table><thead align="left"><tr id="zh-cn_topic_0116784021_row3512281078"><th class="cellrowborder" valign="top" width="18.73%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0116784021_p551628671"><a name="zh-cn_topic_0116784021_p551628671"></a><a name="zh-cn_topic_0116784021_p551628671"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="81.27%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0116784021_p3512813716"><a name="zh-cn_topic_0116784021_p3512813716"></a><a name="zh-cn_topic_0116784021_p3512813716"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0116784021_row1772289712"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_p2732814712"><a name="zh-cn_topic_0116784021_p2732814712"></a><a name="zh-cn_topic_0116784021_p2732814712"></a>start</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_p97172813717"><a name="zh-cn_topic_0116784021_p97172813717"></a><a name="zh-cn_topic_0116784021_p97172813717"></a>一主多备数据库部署模式下启动数据库实例服务、单个主机上的所有实例或单独启动某个节点实例进程，或者直接启动整个AZ。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_row10772813716"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_p1471228371"><a name="zh-cn_topic_0116784021_p1471228371"></a><a name="zh-cn_topic_0116784021_p1471228371"></a>switchover</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_p4718281716"><a name="zh-cn_topic_0116784021_p4718281716"></a><a name="zh-cn_topic_0116784021_p4718281716"></a>一主多备数据库部署模式下切换数据库主备实例，dcf自动选主模式下只支持-n NODEID -D DATADIR。</p>
</td>
</tr>
<tr id="row47801623861"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p778072319614"><a name="p778072319614"></a><a name="p778072319614"></a>finishredo</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p1845716340619"><a name="p1845716340619"></a><a name="p1845716340619"></a>所有备机停止回放，每个分片中选择一个强制升主。</p>
<div class="caution" id="note1445713341613"><a name="note1445713341613"></a><a name="note1445713341613"></a><span class="cautiontitle"> 注意： </span><div class="cautionbody"><p id="p145715341615"><a name="p145715341615"></a><a name="p145715341615"></a>该参数属于高风险操作，请谨慎执行。</p>
</div></div>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_row13782811712"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_p127328274"><a name="zh-cn_topic_0116784021_p127328274"></a><a name="zh-cn_topic_0116784021_p127328274"></a>build</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_p197172818716"><a name="zh-cn_topic_0116784021_p197172818716"></a><a name="zh-cn_topic_0116784021_p197172818716"></a>重建备实例。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_row1879288713"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_p5712819713"><a name="zh-cn_topic_0116784021_p5712819713"></a><a name="zh-cn_topic_0116784021_p5712819713"></a>check</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p939441964612"><a name="p939441964612"></a><a name="p939441964612"></a>检测实例进程运行状态，用户无需关注，不建议使用。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_row8717283718"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_p3719281470"><a name="zh-cn_topic_0116784021_p3719281470"></a><a name="zh-cn_topic_0116784021_p3719281470"></a>stop</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_p972280719"><a name="zh-cn_topic_0116784021_p972280719"></a><a name="zh-cn_topic_0116784021_p972280719"></a>一主多备数据库部署模式下停止数据库实例服务、单个主机上的所有实例或单独停止某个节点实例进程。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_row1670282072"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_p47628373"><a name="zh-cn_topic_0116784021_p47628373"></a><a name="zh-cn_topic_0116784021_p47628373"></a>query</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_p1276281674"><a name="zh-cn_topic_0116784021_p1276281674"></a><a name="zh-cn_topic_0116784021_p1276281674"></a>一主多备数据库部署模式下查询数据库实例状态或者单个主机的状态。</p>
</td>
</tr>
<tr id="row14381747877"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p152263498720"><a name="p152263498720"></a><a name="p152263498720"></a>view</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p13383472716"><a name="p13383472716"></a><a name="p13383472716"></a>查看数据库实例配置文件。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_row9712817716"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_p1271281978"><a name="zh-cn_topic_0116784021_p1271281978"></a><a name="zh-cn_topic_0116784021_p1271281978"></a>set</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_p12713283719"><a name="zh-cn_topic_0116784021_p12713283719"></a><a name="zh-cn_topic_0116784021_p12713283719"></a>设置日志级别，一主多备数据库部署模式下cm_server的仲裁模式、AZ之间的切换模式、cm_server升主模式。</p>
</td>
</tr>
<tr id="row1850113211082"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p550112211786"><a name="p550112211786"></a><a name="p550112211786"></a>set --param</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p6501202116818"><a name="p6501202116818"></a><a name="p6501202116818"></a>设置cm参数，默认set所有节点上的参数，也可以通过-n参数指定set某个节点，具体参数可以参考CM配置参数介绍</a></p>
</td>
</tr>
<tr id="row1662135316255"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p966415322513"><a name="p966415322513"></a><a name="p966415322513"></a>get</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p186641553172510"><a name="p186641553172510"></a><a name="p186641553172510"></a>获取日志级别，一主多备数据库部署模式下cm_server的仲裁模式、AZ之间的切换模式。</p>
</td>
</tr>
<tr id="row1294918104914"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p69493101593"><a name="p69493101593"></a><a name="p69493101593"></a>setrunmode</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p19491010291"><a name="p19491010291"></a><a name="p19491010291"></a>DCF部署方式下，设置DCF投票数，主要用于DCF强启。</p>
</td>
</tr>
<tr id="row412616153913"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p1212614151911"><a name="p1212614151911"></a><a name="p1212614151911"></a>changerole</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p6126171511913"><a name="p6126171511913"></a><a name="p6126171511913"></a>DCF模式下，将角色为primary的修改为passive或者follower。</p>
</td>
</tr>
<tr id="row13434131719918"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p14350171099"><a name="p14350171099"></a><a name="p14350171099"></a>changemember</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p134358171493"><a name="p134358171493"></a><a name="p134358171493"></a>DCF模式下，改变指定DCF节点属性，包括节点角色、节点所在的逻辑组、节点的选举优先级等。</p>
</td>
</tr>
<tr id="row934765319475"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p3348145354718"><a name="p3348145354718"></a><a name="p3348145354718"></a>reload</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p19892194942510"><a name="p19892194942510"></a><a name="p19892194942510"></a>在线加载数据库实例静态配置文件，用户无需关注，不建议使用。</p>
</td>
</tr>
<tr id="row1431318261489"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p631452618487"><a name="p631452618487"></a><a name="p631452618487"></a>reload --param</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p11314192624815"><a name="p11314192624815"></a><a name="p11314192624815"></a>加载可以动态生效的cm参数，部分参数不支持reload，只能重启cm才能生效。</p>
</td>
</tr>
<tr id="row1174130124814"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p1274193034820"><a name="p1274193034820"></a><a name="p1274193034820"></a>list</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p1674123010483"><a name="p1674123010483"></a><a name="p1674123010483"></a>列出cm_agent或cm_server所有的参数。</p>
</td>
</tr>
<tr id="row79323240495"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p69321424194915"><a name="p69321424194915"></a><a name="p69321424194915"></a>encrypt</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p8933624164910"><a name="p8933624164910"></a><a name="p8933624164910"></a>对输入的密码进行加密操作，密码支持8~15位，且必须包含三种字符（数字，字母，符号）。</p>
</td>
</tr>
<tr id="row83491118501"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p2034911110501"><a name="p2034911110501"></a><a name="p2034911110501"></a>ddb</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p203493114508"><a name="p203493114508"></a><a name="p203493114508"></a>DCC模式下，执行dcc命令行。</p>
</td>
</tr>
<tr id="row9198618201015"><td class="cellrowborder" valign="top" width="18.73%" headers="mcps1.2.3.1.1 "><p id="p1386610187104"><a name="p1386610187104"></a><a name="p1386610187104"></a>switch</p>
</td>
<td class="cellrowborder" valign="top" width="81.27%" headers="mcps1.2.3.1.2 "><p id="p819851818100"><a name="p819851818100"></a><a name="p819851818100"></a>执行ddb模式的切换。<p>说明： </p> <p>openGauss当前只支持切换到DCC模式。 </p> </p>
</td>
</tr>
</tbody>
</table>



**表 2**  公共参数

<a name="zh-cn_topic_0116784021_t73f4b6dad11943ea811a211e6c127669"></a>

<table><thead align="left"><tr id="zh-cn_topic_0116784021_r9b2667f4243a4e87b40e7fc0180813c7"><th class="cellrowborder" valign="top" width="27.38%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0116784021_a7ec01558f8ed4028bbf8cdea612a621a"><a name="zh-cn_topic_0116784021_a7ec01558f8ed4028bbf8cdea612a621a"></a><a name="zh-cn_topic_0116784021_a7ec01558f8ed4028bbf8cdea612a621a"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="72.61999999999999%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0116784021_aaad7089c239e47e5b6bb41f0d119a5ea"><a name="zh-cn_topic_0116784021_aaad7089c239e47e5b6bb41f0d119a5ea"></a><a name="zh-cn_topic_0116784021_aaad7089c239e47e5b6bb41f0d119a5ea"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0116784021_r1e184ddb0ba14a27a0c48e56ae67ca44"><td class="cellrowborder" valign="top" width="27.38%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_a6aa8803f607642bb8466be3254e77531"><a name="zh-cn_topic_0116784021_a6aa8803f607642bb8466be3254e77531"></a><a name="zh-cn_topic_0116784021_a6aa8803f607642bb8466be3254e77531"></a>-D DATADIR</p>
</td>
<td class="cellrowborder" valign="top" width="72.61999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_afa2212dded3748a7924ea04efce2280b"><a name="zh-cn_topic_0116784021_afa2212dded3748a7924ea04efce2280b"></a><a name="zh-cn_topic_0116784021_afa2212dded3748a7924ea04efce2280b"></a>指定实例数据目录。仅用于对数据库节点进行操作的命令，如start、stop、switchover、build、setrunmode、changerole、changemember、encrypt。</p>
</td>
</tr>
<tr id="row195328365128"><td class="cellrowborder" valign="top" width="27.38%" headers="mcps1.2.3.1.1 "><p id="p1934113751214"><a name="p1934113751214"></a><a name="p1934113751214"></a>-l FILENAME</p>
</td>
<td class="cellrowborder" valign="top" width="72.61999999999999%" headers="mcps1.2.3.1.2 "><p id="p4140154021210"><a name="p4140154021210"></a><a name="p4140154021210"></a>查询结果输出到指定文件。仅用于查询类的命令，如query、view。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_r3009d9544e694ea0b8c248b152c2fcb0"><td class="cellrowborder" valign="top" width="27.38%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_afa6218bc758d49eca62af42f644e06fe"><a name="zh-cn_topic_0116784021_afa6218bc758d49eca62af42f644e06fe"></a><a name="zh-cn_topic_0116784021_afa6218bc758d49eca62af42f644e06fe"></a>-n NODEID</p>
</td>
<td class="cellrowborder" valign="top" width="72.61999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a18f50a7ab89f42f6bf0cec63b6120a07"><a name="zh-cn_topic_0116784021_a18f50a7ab89f42f6bf0cec63b6120a07"></a><a name="zh-cn_topic_0116784021_a18f50a7ab89f42f6bf0cec63b6120a07"></a>指定节点。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_r84d4692a7d8849c49dfa4e154052725f"><td class="cellrowborder" valign="top" width="27.38%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_aac254a8d2358472289e1a36867cdd244"><a name="zh-cn_topic_0116784021_aac254a8d2358472289e1a36867cdd244"></a><a name="zh-cn_topic_0116784021_aac254a8d2358472289e1a36867cdd244"></a>-z AVAILABILITY_ZONE</p>
</td>
<td class="cellrowborder" valign="top" width="72.61999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a5beacea766d44bbe813c7ac582bba362"><a name="zh-cn_topic_0116784021_a5beacea766d44bbe813c7ac582bba362"></a><a name="zh-cn_topic_0116784021_a5beacea766d44bbe813c7ac582bba362"></a>指定AZ名称。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_r477e0c6128994f0aa7d1bc5910ddc257"><td class="cellrowborder" valign="top" width="27.38%" headers="mcps1.2.3.1.1 "><p id="p122511250131212"><a name="p122511250131212"></a><a name="p122511250131212"></a>-t SECS</p>
</td>
<td class="cellrowborder" valign="top" width="72.61999999999999%" headers="mcps1.2.3.1.2 "><p id="p1497155341214"><a name="p1497155341214"></a><a name="p1497155341214"></a>指定超时时间。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_r8e84c6e9ea2c4544ba81838fade7c37f"><td class="cellrowborder" valign="top" width="27.38%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_a1e0cd0443cda4befb15b7b32ba4eea0e"><a name="zh-cn_topic_0116784021_a1e0cd0443cda4befb15b7b32ba4eea0e"></a><a name="zh-cn_topic_0116784021_a1e0cd0443cda4befb15b7b32ba4eea0e"></a>-V, --version</p>
</td>
<td class="cellrowborder" valign="top" width="72.61999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a99eb4947ce8845f3ae4445d57f800f32"><a name="zh-cn_topic_0116784021_a99eb4947ce8845f3ae4445d57f800f32"></a><a name="zh-cn_topic_0116784021_a99eb4947ce8845f3ae4445d57f800f32"></a>打印cm_ctl版本信息，然后退出。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_rf8678b2ad92b4c5ca6a73aff8b1fdd9a"><td class="cellrowborder" valign="top" width="27.38%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_ae5caaed9829a4efda56af9b389561516"><a name="zh-cn_topic_0116784021_ae5caaed9829a4efda56af9b389561516"></a><a name="zh-cn_topic_0116784021_ae5caaed9829a4efda56af9b389561516"></a>-?, -h,--help</p>
</td>
<td class="cellrowborder" valign="top" width="72.61999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a3f900ff898144a7a82007afa0fb93825"><a name="zh-cn_topic_0116784021_a3f900ff898144a7a82007afa0fb93825"></a><a name="zh-cn_topic_0116784021_a3f900ff898144a7a82007afa0fb93825"></a>显示关于cm_ctl命令行参数的帮助信息，然后退出。</p>
</td>
</tr>
</tbody>
</table>

>![](public_sys-resources/icon-note.gif) **说明：**   
>
>-   此处列出的公共参数并不一定适用于所有命令，而是多个命令支持，为避免冗余信息，所以统一在此说明，详细的使用方法见以上使用方法，也可以使用cm_ctl --help进行查询。


**表 3**  switchover参数

<a name="table12226155814102"></a>

<table><thead align="left"><tr id="row72262584103"><th class="cellrowborder" valign="top" width="22.869999999999997%" id="mcps1.2.3.1.1"><p id="p1722685820101"><a name="p1722685820101"></a><a name="p1722685820101"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="77.13%" id="mcps1.2.3.1.2"><p id="p322605817109"><a name="p322605817109"></a><a name="p322605817109"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row1822715813100"><td class="cellrowborder" valign="top" width="22.869999999999997%" headers="mcps1.2.3.1.1 "><p id="p122279589106"><a name="p122279589106"></a><a name="p122279589106"></a>-a</p>
</td>
<td class="cellrowborder" valign="top" width="77.13%" headers="mcps1.2.3.1.2 "><p id="p182271958161018"><a name="p182271958161018"></a><a name="p182271958161018"></a>重置节点状态为初始配置状态。</p>
<div class="note" id="note4227758151011"><a name="note4227758151011"></a><a name="note4227758151011"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p322713584103"><a name="p322713584103"></a><a name="p322713584103"></a>switchover为维护操作：确保数据库实例状态正常，所有业务结束，并使用pgxc_get_senders_catchup_time()视图查询无主备追赶后，再进行switchover操作。</p>
</div></div>
</td>
</tr>
<tr id="row876891261217"><td class="cellrowborder" valign="top" width="22.869999999999997%" headers="mcps1.2.3.1.1 "><p id="p157683127123"><a name="p157683127123"></a><a name="p157683127123"></a>-A</p>
</td>
<td class="cellrowborder" valign="top" width="77.13%" headers="mcps1.2.3.1.2 "><p id="p5768101211121"><a name="p5768101211121"></a><a name="p5768101211121"></a>将所有节点实例统一从主切换到备。</p>
</td>
</tr>
<tr id="row132271458161020"><td class="cellrowborder" valign="top" width="22.869999999999997%" headers="mcps1.2.3.1.1 "><p id="p6227658191018"><a name="p6227658191018"></a><a name="p6227658191018"></a>-f</p>
</td>
<td class="cellrowborder" valign="top" width="77.13%" headers="mcps1.2.3.1.2 "><p id="p1722775811018"><a name="p1722775811018"></a><a name="p1722775811018"></a>指定进行-f类型switchover。</p>
<div class="note" id="note2022865851012"><a name="note2022865851012"></a><a name="note2022865851012"></a><span class="notetitle"> 说明： </span><div class="notebody"><a name="ul1722865861017"></a><a name="ul1722865861017"></a><ul id="ul1722865861017"><li>switchover为维护操作：确保数据库实例状态正常，所有业务结束，并使用pgxc_get_senders_catchup_time()视图查询无主备追赶后，再进行switchover操作。</li><li>使用方式：cm_ctl switchover -n NODEID -D DATADIR -f。</li></ul>
</div></div>
</td>
</tr>
</tbody>
</table>


**表 4**  build参数

<a name="table649003761312"></a>

<table><thead align="left"><tr id="row1549019377136"><th class="cellrowborder" valign="top" width="36.96%" id="mcps1.2.3.1.1"><p id="p9490837131316"><a name="p9490837131316"></a><a name="p9490837131316"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="63.04%" id="mcps1.2.3.1.2"><p id="p17490937101319"><a name="p17490937101319"></a><a name="p17490937101319"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row20490193716132"><td class="cellrowborder" valign="top" width="36.96%" headers="mcps1.2.3.1.1 "><p id="p24901837141313"><a name="p24901837141313"></a><a name="p24901837141313"></a>-f</p>
</td>
<td class="cellrowborder" valign="top" width="63.04%" headers="mcps1.2.3.1.2 "><p id="p649120371130"><a name="p649120371130"></a><a name="p649120371130"></a>强制重建备机。</p>
</td>
</tr>
<tr id="row20491153713135"><td class="cellrowborder" valign="top" width="36.96%" headers="mcps1.2.3.1.1 "><p id="p16491153712138"><a name="p16491153712138"></a><a name="p16491153712138"></a>-b full</p>
</td>
<td class="cellrowborder" valign="top" width="63.04%" headers="mcps1.2.3.1.2 "><p id="p144918375134"><a name="p144918375134"></a><a name="p144918375134"></a>指定进行全量build。不指定情况下，对于一主多备数据库实例部署模式进行auto build。auto build指：先调用增量build，失败之后调用全量build。</p>
</td>
</tr>
<tr id="row66031246131316"><td class="cellrowborder" valign="top" width="36.96%" headers="mcps1.2.3.1.1 "><p id="p1860354615133"><a name="p1860354615133"></a><a name="p1860354615133"></a>-c</p>
</td>
<td class="cellrowborder" valign="top" width="63.04%" headers="mcps1.2.3.1.2 "><p id="p613211713369"><a name="p613211713369"></a><a name="p613211713369"></a>重建 cm_server（将主节点的DCC数据目录拷贝到指定节点，只适用于一主一备模式）。</p>
</td>
</tr>
</tbody>
</table>



**表 5**  check参数

<a name="zh-cn_topic_0116784021_t5582631c9b25449da85855fab919ddfd"></a>

<table><thead align="left"><tr id="zh-cn_topic_0116784021_rd37f17597d4247e0ae482955d9309dec"><th class="cellrowborder" valign="top" width="37.41%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0116784021_a01a077aed6494d02a3281d4e8099e93f"><a name="zh-cn_topic_0116784021_a01a077aed6494d02a3281d4e8099e93f"></a><a name="zh-cn_topic_0116784021_a01a077aed6494d02a3281d4e8099e93f"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="62.59%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0116784021_a7a38ec4d685b4f47b90e0ad9a4f50824"><a name="zh-cn_topic_0116784021_a7a38ec4d685b4f47b90e0ad9a4f50824"></a><a name="zh-cn_topic_0116784021_a7a38ec4d685b4f47b90e0ad9a4f50824"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0116784021_rd8c1b7cddd6f427d9694f264d2005cac"><td class="cellrowborder" valign="top" width="37.41%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_ab803457b0a634b51b9dded46a033ccd3"><a name="zh-cn_topic_0116784021_ab803457b0a634b51b9dded46a033ccd3"></a><a name="zh-cn_topic_0116784021_ab803457b0a634b51b9dded46a033ccd3"></a>-B BINNAME</p>
</td>
<td class="cellrowborder" valign="top" width="62.59%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_ac55816c176ab4706a6aadb8ad7593023"><a name="zh-cn_topic_0116784021_ac55816c176ab4706a6aadb8ad7593023"></a><a name="zh-cn_topic_0116784021_ac55816c176ab4706a6aadb8ad7593023"></a>指定进程名，其进程名包括“cm_agent”,“gaussdb”和“cm_server”。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_rd2e1192de08d42bcaade8ca56005ffc1"><td class="cellrowborder" valign="top" width="37.41%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_a4e9f52921a6d48ef83bdfe09118a36b2"><a name="zh-cn_topic_0116784021_a4e9f52921a6d48ef83bdfe09118a36b2"></a><a name="zh-cn_topic_0116784021_a4e9f52921a6d48ef83bdfe09118a36b2"></a>-T DATAPATH</p>
</td>
<td class="cellrowborder" valign="top" width="62.59%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_ab3ea48e85af841789dc64a1178000c5a"><a name="zh-cn_topic_0116784021_ab3ea48e85af841789dc64a1178000c5a"></a><a name="zh-cn_topic_0116784021_ab3ea48e85af841789dc64a1178000c5a"></a>指定实例数据目录。</p>
</td>
</tr>
</tbody>
</table>


**表 6**  stop参数

<a name="zh-cn_topic_0116784021_t7507cabe697c4b4da00814fccee8e559"></a>

<table><thead align="left"><tr id="zh-cn_topic_0116784021_r9fe46923fdac41adafc1d99fc26394fe"><th class="cellrowborder" valign="top" width="32.15%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0116784021_ac69b26b26eaf444d8976b4a02ebfa755"><a name="zh-cn_topic_0116784021_ac69b26b26eaf444d8976b4a02ebfa755"></a><a name="zh-cn_topic_0116784021_ac69b26b26eaf444d8976b4a02ebfa755"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="67.85%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0116784021_a2149847c7cee4befb99d6feded576a60"><a name="zh-cn_topic_0116784021_a2149847c7cee4befb99d6feded576a60"></a><a name="zh-cn_topic_0116784021_a2149847c7cee4befb99d6feded576a60"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0116784021_rd03f46c5234c4d7e8f26720fb785b37c"><td class="cellrowborder" valign="top" width="32.15%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_add073231a45d453b801c35a3eb22b469"><a name="zh-cn_topic_0116784021_add073231a45d453b801c35a3eb22b469"></a><a name="zh-cn_topic_0116784021_add073231a45d453b801c35a3eb22b469"></a>-m SHUTDOWN-MODE</p>
</td>
<td class="cellrowborder" valign="top" width="67.85%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a420b6d7e3a0c471d9cfc5e497dd028bc"><a name="zh-cn_topic_0116784021_a420b6d7e3a0c471d9cfc5e497dd028bc"></a><a name="zh-cn_topic_0116784021_a420b6d7e3a0c471d9cfc5e497dd028bc"></a>指定停止模式，停止模式有以下几种：</p>
<a name="ul116320588224"></a><a name="ul116320588224"></a><ul id="ul116320588224"><li>smart（s）：等待用户业务结束后，停止所有数据库实例。</li><li>fast（f）：不等待用户业务结束，指定数据库实例退出。</li><li>immediate（i）：不等待用户业务结束，指定数据库实例强制退出。</li></ul>
</td>
</tr>
</tbody>
</table>



**表 7**  query参数

<a name="zh-cn_topic_0116784021_t19badc48929f4f9abd94b8ac774f06c1"></a>

<table><thead align="left"><tr id="zh-cn_topic_0116784021_r95c34a3a3d3b46c4acc26ae7505b45a6"><th class="cellrowborder" valign="top" width="19.43%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0116784021_a1604cdeb3e414559ae3d5f833f16552b"><a name="zh-cn_topic_0116784021_a1604cdeb3e414559ae3d5f833f16552b"></a><a name="zh-cn_topic_0116784021_a1604cdeb3e414559ae3d5f833f16552b"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="80.57%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0116784021_a571c87b4d9294e02bd2aed23a771d5a0"><a name="zh-cn_topic_0116784021_a571c87b4d9294e02bd2aed23a771d5a0"></a><a name="zh-cn_topic_0116784021_a571c87b4d9294e02bd2aed23a771d5a0"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row1129820320157"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p12982030155"><a name="p12982030155"></a><a name="p12982030155"></a>-s</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a842704ebd6fc4221aaba924dc932ff55"><a name="zh-cn_topic_0116784021_a842704ebd6fc4221aaba924dc932ff55"></a><a name="zh-cn_topic_0116784021_a842704ebd6fc4221aaba924dc932ff55"></a>显示导致各个节点主备实例数量不均衡的实例。</p>
<div class="note" id="zh-cn_topic_0116784021_nc60bc80c518c49eda2b35d562147346b"><a name="zh-cn_topic_0116784021_nc60bc80c518c49eda2b35d562147346b"></a><a name="zh-cn_topic_0116784021_nc60bc80c518c49eda2b35d562147346b"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0116784021_af1994683c8554b83b1b0e4aabdbcf7cd"><a name="zh-cn_topic_0116784021_af1994683c8554b83b1b0e4aabdbcf7cd"></a><a name="zh-cn_topic_0116784021_af1994683c8554b83b1b0e4aabdbcf7cd"></a>-s参数需要和-v以及-C参数一起使用才能按主备关系成对显示导致各个节点主备实例数量不均衡的实例，使用-s参数时，必须指定-C、-v参数。</p>
</div></div>
</td>
</tr>
<tr id="row65832211151"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p0583221191520"><a name="p0583221191520"></a><a name="p0583221191520"></a>-C</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a4b79f2da8c494569857808ffd61f71a5"><a name="zh-cn_topic_0116784021_a4b79f2da8c494569857808ffd61f71a5"></a><a name="zh-cn_topic_0116784021_a4b79f2da8c494569857808ffd61f71a5"></a>按主备关系成对显示数据库实例状态。</p>
<div class="note" id="zh-cn_topic_0116784021_n731aa2a43352481e978b12c5553265bb"><a name="zh-cn_topic_0116784021_n731aa2a43352481e978b12c5553265bb"></a><a name="zh-cn_topic_0116784021_n731aa2a43352481e978b12c5553265bb"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0116784021_a39570561395642a98889ff545e5199f0"><a name="zh-cn_topic_0116784021_a39570561395642a98889ff545e5199f0"></a><a name="zh-cn_topic_0116784021_a39570561395642a98889ff545e5199f0"></a>-C参数需要和-v参数一起使用才能按主备关系成对显示数据库实例详细状态信息，使用-C时，必须指定-v参数。</p>
</div></div>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_r553167c4166044a0b29f84a7883ccc75"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_a999edbdbff544c99ba456dd23e519dac"><a name="zh-cn_topic_0116784021_a999edbdbff544c99ba456dd23e519dac"></a><a name="zh-cn_topic_0116784021_a999edbdbff544c99ba456dd23e519dac"></a>-v</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a925da3184e614f288fce5a63a2916abf"><a name="zh-cn_topic_0116784021_a925da3184e614f288fce5a63a2916abf"></a><a name="zh-cn_topic_0116784021_a925da3184e614f288fce5a63a2916abf"></a>显示详细数据库实例状态。</p>
<div class="note" id="zh-cn_topic_0116784021_n40330e074da34b2da0c80b95a9493f29"><a name="zh-cn_topic_0116784021_n40330e074da34b2da0c80b95a9493f29"></a><a name="zh-cn_topic_0116784021_n40330e074da34b2da0c80b95a9493f29"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0116784021_a37464d4740da49ac813a633ba7dd3ad0"><a name="zh-cn_topic_0116784021_a37464d4740da49ac813a633ba7dd3ad0"></a><a name="zh-cn_topic_0116784021_a37464d4740da49ac813a633ba7dd3ad0"></a>数据库实例有如下几种状态：</p>
<a name="zh-cn_topic_0116784021_uda4877377f8c4db6a498b7fed7873ea5"></a><a name="zh-cn_topic_0116784021_uda4877377f8c4db6a498b7fed7873ea5"></a><ul id="zh-cn_topic_0116784021_uda4877377f8c4db6a498b7fed7873ea5"><li>Normal：表示数据库实例可用，且数据有冗余备份。所有进程都在运行，主备关系正常。</li><li>Degraded：表示数据库实例可用，但数据没有冗余备份。</li><li>Unavailable：表示数据库实例不可用。</li></ul>
</div></div>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_rf77a30064bae47b3b55158207950b428"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_a15fcb4494e4c469ba1cd5c4cf245309b"><a name="zh-cn_topic_0116784021_a15fcb4494e4c469ba1cd5c4cf245309b"></a><a name="zh-cn_topic_0116784021_a15fcb4494e4c469ba1cd5c4cf245309b"></a>-d</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_a440eac8bd72d47b89536e3204d64c34c"><a name="zh-cn_topic_0116784021_a440eac8bd72d47b89536e3204d64c34c"></a><a name="zh-cn_topic_0116784021_a440eac8bd72d47b89536e3204d64c34c"></a>显示实例数据目录。</p>
<div class="note" id="zh-cn_topic_0116784021_n34b3cecab92d4d8798e0839da2a6d3bd"><a name="zh-cn_topic_0116784021_n34b3cecab92d4d8798e0839da2a6d3bd"></a><a name="zh-cn_topic_0116784021_n34b3cecab92d4d8798e0839da2a6d3bd"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0116784021_a96799a456e334a499e7a5369cb7f02b5"><a name="zh-cn_topic_0116784021_a96799a456e334a499e7a5369cb7f02b5"></a><a name="zh-cn_topic_0116784021_a96799a456e334a499e7a5369cb7f02b5"></a>-d参数需要和-v以及-C参数一起使用。</p>
</div></div>
</td>
</tr>
<tr id="row52574051616"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_a67311a740bdb4055adb5ab46efe4e860"><a name="zh-cn_topic_0116784021_a67311a740bdb4055adb5ab46efe4e860"></a><a name="zh-cn_topic_0116784021_a67311a740bdb4055adb5ab46efe4e860"></a>-i</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_ac117ca8771bf4cef8f424b4fd0d658c5"><a name="zh-cn_topic_0116784021_ac117ca8771bf4cef8f424b4fd0d658c5"></a><a name="zh-cn_topic_0116784021_ac117ca8771bf4cef8f424b4fd0d658c5"></a>显示物理节点ip。</p>
<div class="note" id="zh-cn_topic_0116784021_n4f315e9ba51145dd9128d814932da195"><a name="zh-cn_topic_0116784021_n4f315e9ba51145dd9128d814932da195"></a><a name="zh-cn_topic_0116784021_n4f315e9ba51145dd9128d814932da195"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0116784021_ad62086b6f32c49a69a1d742ff34aa2ad"><a name="zh-cn_topic_0116784021_ad62086b6f32c49a69a1d742ff34aa2ad"></a><a name="zh-cn_topic_0116784021_ad62086b6f32c49a69a1d742ff34aa2ad"></a>-i参数需要和-v以及-C参数一起使用。</p>
</div></div>
</td>
</tr>
<tr id="row523414981611"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p9234134911620"><a name="p9234134911620"></a><a name="p9234134911620"></a>-F</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_p1071913172256"><a name="zh-cn_topic_0116784021_p1071913172256"></a><a name="zh-cn_topic_0116784021_p1071913172256"></a>显示各个节点Fenced UDF状态。</p>
<div class="note" id="zh-cn_topic_0116784021_note14720161711256"><a name="zh-cn_topic_0116784021_note14720161711256"></a><a name="zh-cn_topic_0116784021_note14720161711256"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0116784021_p1722151716253"><a name="zh-cn_topic_0116784021_p1722151716253"></a><a name="zh-cn_topic_0116784021_p1722151716253"></a>-F参数需要和-v以及-C参数一起使用才能显示各个节点Fenced UDF状态，使用-F参数时，必须指定-C、-v参数。</p>
</div></div>
</td>
</tr>
<tr id="row72113163521"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p7211167171713"><a name="p7211167171713"></a><a name="p7211167171713"></a>-z ALL</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="p179912235284"><a name="p179912235284"></a><a name="p179912235284"></a>显示数据库实例所在AZ名称。</p>
<div class="note" id="note2620241288"><a name="note2620241288"></a><a name="note2620241288"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p1234192413287"><a name="p1234192413287"></a><a name="p1234192413287"></a>-z参数需要和-v以及-C参数一起使用，并且-z后面需要跟参数ALL。</p>
</div></div>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_r91a86e28e010481eaf36b9c0de2c3820"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p172271611523"><a name="p172271611523"></a><a name="p172271611523"></a>-r</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="p52221655217"><a name="p52221655217"></a><a name="p52221655217"></a>显示备机redo状态。</p>
<div class="note" id="note844444714528"><a name="note844444714528"></a><a name="note844444714528"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p1844594775210"><a name="p1844594775210"></a><a name="p1844594775210"></a>使用-r时，必须指定-v参数。</p>
</div></div>
</td>
</tr>
<tr id="row6520145815401"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p35211358194014"><a name="p35211358194014"></a><a name="p35211358194014"></a>-g</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="p15168320103413"><a name="p15168320103413"></a><a name="p15168320103413"></a>显示备份和恢复群集信息。</p>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_row464311132254"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p1573810068"><a name="p1573810068"></a><a name="p1573810068"></a>-x</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="p1773840868"><a name="p1773840868"></a><a name="p1773840868"></a>显示所有异常的数据库实例。</p>
<div class="note" id="note10739110060"><a name="note10739110060"></a><a name="note10739110060"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p15739160960"><a name="p15739160960"></a><a name="p15739160960"></a>-x参数需要和-v以及-C参数一起使用。</p>
</div></div>
</td>
</tr>
<tr id="zh-cn_topic_0116784021_r0c7619ba8f3f445196dc6b76a354f937"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_ab515c4c4117c461295e58b95c1da869a"><a name="zh-cn_topic_0116784021_ab515c4c4117c461295e58b95c1da869a"></a><a name="zh-cn_topic_0116784021_ab515c4c4117c461295e58b95c1da869a"></a>-S</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="p11633175118493"><a name="p11633175118493"></a><a name="p11633175118493"></a>显示数据库实例启动时的状态检查结果。</p>
<div class="note" id="note563385194914"><a name="note563385194914"></a><a name="note563385194914"></a><span class="notetitle"> 说明： </span><div class="notebody"><div class="p" id="p36334518495"><a name="p36334518495"></a><a name="p36334518495"></a>-S参数需要和-v以及-C参数一起使用才能按显示数据库实例的状态检查结果。有以下三种状态：<a name="ul291533852718"></a><a name="ul291533852718"></a><ul id="ul291533852718"><li>Normal：表示数据库实例可用，且数据有冗余备份。所有进程都在运行，主备关系正常。</li><li>Degraded：表示数据库实例可用，但数据没有冗余备份。</li><li>Unavailable：表示数据库实例不可用。</li></ul>
</div>
</div></div>
</td>
</tr>
<tr id="row1939914596122"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p17400105901210"><a name="p17400105901210"></a><a name="p17400105901210"></a>--minorityAz</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="p1440025912126"><a name="p1440025912126"></a><a name="p1440025912126"></a>只查询指定AZ的cms。</p>
<div class="note" id="note1384679188"><a name="note1384679188"></a><a name="note1384679188"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p7844715187"><a name="p7844715187"></a><a name="p7844715187"></a>此参数会忽略非指定AZ的cms节点，可以在少数派场景提高查询速度。</p>
</div></div>
</td>
</tr>
<tr id="row20168820153413"><td class="cellrowborder" valign="top" width="19.43%" headers="mcps1.2.3.1.1 "><p id="p1316811209341"><a name="p1316811209341"></a><a name="p1316811209341"></a>-p</p>
</td>
<td class="cellrowborder" valign="top" width="80.57%" headers="mcps1.2.3.1.2 "><p id="p11386175715616"><a name="p11386175715616"></a><a name="p11386175715616"></a>显示数据库实例所有节点端口。</p>
<div class="note" id="note938765713620"><a name="note938765713620"></a><a name="note938765713620"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p13871857266"><a name="p13871857266"></a><a name="p13871857266"></a>-p参数需要和-v以及-C参数一起使用。</p>
</div></div>
</td>
</tr>
</tbody>
</table>



**表 8**  set参数

<a name="zh-cn_topic_0116784021_tef5e0858a71c4d21abce8f80e3ba7723"></a>

<table><thead align="left"><tr id="zh-cn_topic_0116784021_rff0042d520c048e9a9920b990bd58afe"><th class="cellrowborder" valign="top" width="35.120000000000005%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0116784021_a8f0c292661264b72ba915297a9510a00"><a name="zh-cn_topic_0116784021_a8f0c292661264b72ba915297a9510a00"></a><a name="zh-cn_topic_0116784021_a8f0c292661264b72ba915297a9510a00"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="64.88000000000001%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0116784021_adfb37b0213a2402fb66d0033431adc08"><a name="zh-cn_topic_0116784021_adfb37b0213a2402fb66d0033431adc08"></a><a name="zh-cn_topic_0116784021_adfb37b0213a2402fb66d0033431adc08"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0116784021_r922b5d9f35404fb48604c9882f09b336"><td class="cellrowborder" valign="top" width="35.120000000000005%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0116784021_aa76794bdce4845c5ba86de984106438c"><a name="zh-cn_topic_0116784021_aa76794bdce4845c5ba86de984106438c"></a><a name="zh-cn_topic_0116784021_aa76794bdce4845c5ba86de984106438c"></a>--log_level=LOG_LEVEL</p>
</td>
<td class="cellrowborder" valign="top" width="64.88000000000001%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0116784021_ac533a5fc9d824ed2821ba1216c397d78"><a name="zh-cn_topic_0116784021_ac533a5fc9d824ed2821ba1216c397d78"></a><a name="zh-cn_topic_0116784021_ac533a5fc9d824ed2821ba1216c397d78"></a>设置主cm_server日志级别。共分为DEBUG5、DEBUG1、WARNING、LOG、ERROR和FATAL六个级别，日志打印信息级别越来越高。设置日志级别越高，输出日志信息就越少。</p>
</td>
</tr>
<tr id="row461575013278"><td class="cellrowborder" valign="top" width="35.120000000000005%" headers="mcps1.2.3.1.1 "><p id="p5616750122715"><a name="p5616750122715"></a><a name="p5616750122715"></a>--cm_arbitration_mode=ARBITRATION_MODE</p>
</td>
<td class="cellrowborder" valign="top" width="64.88000000000001%" headers="mcps1.2.3.1.2 "><p id="p26161150132714"><a name="p26161150132714"></a><a name="p26161150132714"></a>一主多备功能，设置cm_server的仲裁模式。共有MAJORITY、MINORITY两种模式，MAJORITY为多数派模式，MINORITY为少数派模式。openGauss不支持少数派，此参数可以设置成MINORITY，但不会生效。</p>
</td>
</tr>
<tr id="row1622416576276"><td class="cellrowborder" valign="top" width="35.120000000000005%" headers="mcps1.2.3.1.1 "><p id="p123344326288"><a name="p123344326288"></a><a name="p123344326288"></a>--cm_switchover_az_mode=</p>
<p id="p83351832122816"><a name="p83351832122816"></a><a name="p83351832122816"></a>SWITCHOVER_AZ_MODE</p>
</td>
<td class="cellrowborder" valign="top" width="64.88000000000001%" headers="mcps1.2.3.1.2 "><p id="p2226155722719"><a name="p2226155722719"></a><a name="p2226155722719"></a>一主多备功能，设置AZ之间的自动切换开关。共有NON_AUTO、AUTO两种模式，NON_AUTO为非自动切换模式，AUTO为自动切换模式。AUTO模式由主cm_server自动控制AZ1和AZ2之间的节点实例切换。</p>
</td>
</tr>
<tr id="row42457165812"><td class="cellrowborder" valign="top" width="35.120000000000005%" headers="mcps1.2.3.1.1 "><p id="p1424671620810"><a name="p1424671620810"></a><a name="p1424671620810"></a>--cmsPromoteMode=CMS_PROMOTE_MODE -I INSTANCEID</p>
</td>
<td class="cellrowborder" valign="top" width="64.88000000000001%" headers="mcps1.2.3.1.2 "><p id="p162467161987"><a name="p162467161987"></a><a name="p162467161987"></a>设置cm_server的升主方式，共有AUTO、PRIMARY_F两种模式，AUTO为默认自选主方式，PRIMARY_F会强制使-I指定的节点升主，无论当前是否有主，因此，有可能会导致cms存在多主情况。</p>
</td>
</tr>
</tbody>
</table>



**表 9**  set cm参数

<a name="table10437204416514"></a>

<table><thead align="left"><tr id="row1743716445512"><th class="cellrowborder" valign="top" width="24.75%" id="mcps1.2.3.1.1"><p id="p54386442055"><a name="p54386442055"></a><a name="p54386442055"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="75.25%" id="mcps1.2.3.1.2"><p id="p15438944158"><a name="p15438944158"></a><a name="p15438944158"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row10308104323615"><td class="cellrowborder" valign="top" width="24.75%" headers="mcps1.2.3.1.1 "><p id="p4784850203614"><a name="p4784850203614"></a><a name="p4784850203614"></a>--param</p>
</td>
<td class="cellrowborder" valign="top" width="75.25%" headers="mcps1.2.3.1.2 "><p id="p1378411501367"><a name="p1378411501367"></a><a name="p1378411501367"></a>表明需要设置cm参数，不带此参数则不能执行设置cm参数。</p>
</td>
</tr>
<tr id="row1243814448520"><td class="cellrowborder" valign="top" width="24.75%" headers="mcps1.2.3.1.1 "><p id="p64381244256"><a name="p64381244256"></a><a name="p64381244256"></a>--agent | --server</p>
</td>
<td class="cellrowborder" valign="top" width="75.25%" headers="mcps1.2.3.1.2 "><p id="p72351114768"><a name="p72351114768"></a><a name="p72351114768"></a>此参数为必带参数，表明当前需要设置cm_server还是cm_agent的参数。</p>
</td>
</tr>
<tr id="row179561119550"><td class="cellrowborder" valign="top" width="24.75%" headers="mcps1.2.3.1.1 "><p id="p8956119552"><a name="p8956119552"></a><a name="p8956119552"></a>-k parameter="value"</p>
</td>
<td class="cellrowborder" valign="top" width="75.25%" headers="mcps1.2.3.1.2 "><p id="p195661914515"><a name="p195661914515"></a><a name="p195661914515"></a>指定设置的参数和参数的值，只能设置已经存在的参数，不支持增加或删减参数。</p>
</td>
</tr>
</tbody>
</table>


**表 10**  get参数

<a name="table1599151916313"></a>

<table><thead align="left"><tr id="row2991719183112"><th class="cellrowborder" valign="top" width="36.559999999999995%" id="mcps1.2.3.1.1"><p id="p11331611153415"><a name="p11331611153415"></a><a name="p11331611153415"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="63.44%" id="mcps1.2.3.1.2"><p id="p1587112152345"><a name="p1587112152345"></a><a name="p1587112152345"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row1399151933116"><td class="cellrowborder" valign="top" width="36.559999999999995%" headers="mcps1.2.3.1.1 "><p id="p1642213231347"><a name="p1642213231347"></a><a name="p1642213231347"></a>--log_level=LOG_LEVEL</p>
</td>
<td class="cellrowborder" valign="top" width="63.44%" headers="mcps1.2.3.1.2 "><p id="p8277436173410"><a name="p8277436173410"></a><a name="p8277436173410"></a>获取主cm_server日志级别。共分为DEBUG5、DEBUG1、WARNING、LOG、ERROR和FATAL六个级别，日志打印信息级别越来越高。设置日志级别越高，输出日志信息就越少。</p>
</td>
</tr>
<tr id="row1699121903112"><td class="cellrowborder" valign="top" width="36.559999999999995%" headers="mcps1.2.3.1.1 "><p id="p2991919143114"><a name="p2991919143114"></a><a name="p2991919143114"></a>--cm_arbitration_mode=ARBITRATION_MODE</p>
</td>
<td class="cellrowborder" valign="top" width="63.44%" headers="mcps1.2.3.1.2 "><p id="p1699131919316"><a name="p1699131919316"></a><a name="p1699131919316"></a>一主多备功能，获取cm_server的仲裁模式。共有MAJORITY、MINORITY两种模式，MAJORITY为多数派模式，MINORITY为少数派模式。少数派模式适用于一主多备数据库部署并且只有AZ3存活时，此时cm_server可以进行正常的仲裁业务，非此模式下将仲裁模式设置成少数派成功后，cm会自动将仲裁模式改为多数派，以保证集群正常运转；多数派模式适用于一主多备数据库部署并且各个组件（cm_server，节点）存活数量大于一半的场景。数据库实例正常情况下默认为多数派模式。</p>
<div class="caution" id="note9231439203710"><a name="note9231439203710"></a><a name="note9231439203710"></a><span class="cautiontitle"> 注意： </span><div class="cautionbody"><p id="p1122639103710"><a name="p1122639103710"></a><a name="p1122639103710"></a>openGauss不支持少数派</p>
</div></div>
</td>
</tr>
<tr id="row17991519113117"><td class="cellrowborder" valign="top" width="36.559999999999995%" headers="mcps1.2.3.1.1 "><p id="p1237992903510"><a name="p1237992903510"></a><a name="p1237992903510"></a>--cm_switchover_az_mode</p>
<p id="p83401424173512"><a name="p83401424173512"></a><a name="p83401424173512"></a>=SWITCHOVER_AZ_MODE</p>
</td>
<td class="cellrowborder" valign="top" width="63.44%" headers="mcps1.2.3.1.2 "><p id="p655611817358"><a name="p655611817358"></a><a name="p655611817358"></a>一主多备功能，获取AZ之间的自动切换开关。共有NON_AUTO、AUTO两种模式，NON_AUTO为非自动切换模式，AUTO为自动切换模式。AUTO模式由主cm_server自动控制AZ1和AZ2之间的节点实例切换。</p>
</td>
</tr>
</tbody>
</table>


**表 11**  view参数

<a name="zh-cn_topic_0116784021_table207722104617"></a>

<table><thead align="left"><tr id="zh-cn_topic_0116784021_row67721210367"><th class="cellrowborder" valign="top" width="29.470000000000002%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0116784021_p139843241269"><a name="zh-cn_topic_0116784021_p139843241269"></a><a name="zh-cn_topic_0116784021_p139843241269"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="70.53%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0116784021_p199867246618"><a name="zh-cn_topic_0116784021_p199867246618"></a><a name="zh-cn_topic_0116784021_p199867246618"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row730813337919"><td class="cellrowborder" valign="top" width="29.470000000000002%" headers="mcps1.2.3.1.1 "><p id="p163098331196"><a name="p163098331196"></a><a name="p163098331196"></a>-v</p>
</td>
<td class="cellrowborder" valign="top" width="70.53%" headers="mcps1.2.3.1.2 "><p id="p11207208477"><a name="p11207208477"></a><a name="p11207208477"></a>显示数据库实例所有节点的静态配置详细信息。</p>
<div class="note" id="note155818124710"><a name="note155818124710"></a><a name="note155818124710"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p6581814476"><a name="p6581814476"></a><a name="p6581814476"></a>相对于cm_ctl view命令，-v 显示内容增加了cmserver、节点组件的编号显示，如下：cmseverInstanceID，datanodeInstanceID。</p>
</div></div>
</td>
</tr>
<tr id="row3618144510122"><td class="cellrowborder" valign="top" width="29.470000000000002%" headers="mcps1.2.3.1.1 "><p id="p146181345121215"><a name="p146181345121215"></a><a name="p146181345121215"></a>-N</p>
</td>
<td class="cellrowborder" valign="top" width="70.53%" headers="mcps1.2.3.1.2 "><p id="p176180458126"><a name="p176180458126"></a><a name="p176180458126"></a>只显示本节点的静态配置信息，即执行cm_ctl view命令的节点的信息，N表示Native。</p>
</td>
</tr>
</tbody>
</table>


**表 12**  setrunmode参数

<a name="table1656519521713"></a>

<table><thead align="left"><tr id="row656520511176"><th class="cellrowborder" valign="top" width="21.802180218021803%" id="mcps1.2.4.1.1"><p id="p155654511171"><a name="p155654511171"></a><a name="p155654511171"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="28.35283528352835%" id="mcps1.2.4.1.2"><p id="p65652516172"><a name="p65652516172"></a><a name="p65652516172"></a>参数说明</p>
</th>
<th class="cellrowborder" valign="top" width="49.84498449844985%" id="mcps1.2.4.1.3"><p id="p868045681719"><a name="p868045681719"></a><a name="p868045681719"></a>取值范围</p>
</th>
</tr>
</thead>
<tbody><tr id="row1456505131713"><td class="cellrowborder" valign="top" width="21.802180218021803%" headers="mcps1.2.4.1.1 "><p id="p205654561717"><a name="p205654561717"></a><a name="p205654561717"></a>--xmode</p>
</td>
<td class="cellrowborder" valign="top" width="28.35283528352835%" headers="mcps1.2.4.1.2 "><p id="p656595141715"><a name="p656595141715"></a><a name="p656595141715"></a>指定DCF的运行模式。</p>
</td>
<td class="cellrowborder" valign="top" width="49.84498449844985%" headers="mcps1.2.4.1.3 "><a name="ul114721049101719"></a><a name="ul114721049101719"></a><ul id="ul114721049101719"><li>normal：正常模式。</li><li>minority：少数派模式，需要--votenum指定投票数。</li></ul>
</td>
</tr>
<tr id="row956514518173"><td class="cellrowborder" valign="top" width="21.802180218021803%" headers="mcps1.2.4.1.1 "><p id="p1056520581715"><a name="p1056520581715"></a><a name="p1056520581715"></a>--votenum</p>
</td>
<td class="cellrowborder" valign="top" width="28.35283528352835%" headers="mcps1.2.4.1.2 "><p id="p165651857172"><a name="p165651857172"></a><a name="p165651857172"></a>指定DCF少数派运行方式的投票数。</p>
</td>
<td class="cellrowborder" valign="top" width="49.84498449844985%" headers="mcps1.2.4.1.3 "><p id="p1256585101719"><a name="p1256585101719"></a><a name="p1256585101719"></a>正整数，不高于DCF总副本数。</p>
</td>
</tr>
</tbody>
</table>


**表 13**  changerole参数

<a name="table326418392182"></a>

<table><thead align="left"><tr id="row5264133917189"><th class="cellrowborder" valign="top" width="21.67%" id="mcps1.2.4.1.1"><p id="p122641139121814"><a name="p122641139121814"></a><a name="p122641139121814"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="28.439999999999998%" id="mcps1.2.4.1.2"><p id="p3264739191818"><a name="p3264739191818"></a><a name="p3264739191818"></a>参数说明</p>
</th>
<th class="cellrowborder" valign="top" width="49.89%" id="mcps1.2.4.1.3"><p id="p56175205198"><a name="p56175205198"></a><a name="p56175205198"></a>取值范围</p>
</th>
</tr>
</thead>
<tbody><tr id="row18264133919182"><td class="cellrowborder" valign="top" width="21.67%" headers="mcps1.2.4.1.1 "><p id="p1726433910185"><a name="p1726433910185"></a><a name="p1726433910185"></a>--role</p>
</td>
<td class="cellrowborder" valign="top" width="28.439999999999998%" headers="mcps1.2.4.1.2 "><p id="p18264143931814"><a name="p18264143931814"></a><a name="p18264143931814"></a>DCF模式下，将角色为primary的修改为passive或者follower。</p>
</td>
<td class="cellrowborder" valign="top" width="49.89%" headers="mcps1.2.4.1.3 "><a name="ul9521516141916"></a><a name="ul9521516141916"></a><ul id="ul9521516141916"><li>passive：passive角色。</li><li>follower：follow角色。</li></ul>
</td>
</tr>
</tbody>
</table>


**表 14**  changemember参数

<a name="table27311655104911"></a>

<table><thead align="left"><tr id="row073285510494"><th class="cellrowborder" valign="top" width="22.11%" id="mcps1.2.4.1.1"><p id="p14732455194911"><a name="p14732455194911"></a><a name="p14732455194911"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="36.93%" id="mcps1.2.4.1.2"><p id="p18732155514495"><a name="p18732155514495"></a><a name="p18732155514495"></a>参数说明</p>
</th>
<th class="cellrowborder" valign="top" width="40.96%" id="mcps1.2.4.1.3"><p id="p1273285517492"><a name="p1273285517492"></a><a name="p1273285517492"></a>取值范围</p>
</th>
</tr>
</thead>
<tbody><tr id="row17732055144916"><td class="cellrowborder" valign="top" width="22.11%" headers="mcps1.2.4.1.1 "><p id="p14732205513497"><a name="p14732205513497"></a><a name="p14732205513497"></a>--role</p>
</td>
<td class="cellrowborder" valign="top" width="36.93%" headers="mcps1.2.4.1.2 "><p id="p11732195564918"><a name="p11732195564918"></a><a name="p11732195564918"></a>DCF模式下，将角色为primary的修改为passive或者follower。</p>
</td>
<td class="cellrowborder" valign="top" width="40.96%" headers="mcps1.2.4.1.3 "><a name="ul27324551495"></a><a name="ul27324551495"></a><ul id="ul27324551495"><li>passive：passive角色。</li><li>follower：follow角色。</li></ul>
</td>
</tr>
<tr id="row85359260508"><td class="cellrowborder" valign="top" width="22.11%" headers="mcps1.2.4.1.1 "><p id="p653602616508"><a name="p653602616508"></a><a name="p653602616508"></a>--group</p>
</td>
<td class="cellrowborder" valign="top" width="36.93%" headers="mcps1.2.4.1.2 "><p id="p115363266505"><a name="p115363266505"></a><a name="p115363266505"></a>DCF模式下，修改group的值。</p>
</td>
<td class="cellrowborder" valign="top" width="40.96%" headers="mcps1.2.4.1.3 "><p id="p135362266507"><a name="p135362266507"></a><a name="p135362266507"></a>0~2147483647</p>
</td>
</tr>
<tr id="row199431655317"><td class="cellrowborder" valign="top" width="22.11%" headers="mcps1.2.4.1.1 "><p id="p2094316135319"><a name="p2094316135319"></a><a name="p2094316135319"></a>--priority</p>
</td>
<td class="cellrowborder" valign="top" width="36.93%" headers="mcps1.2.4.1.2 "><p id="p8941116195318"><a name="p8941116195318"></a><a name="p8941116195318"></a>DCF模式下，修改priority的值。</p>
</td>
<td class="cellrowborder" valign="top" width="40.96%" headers="mcps1.2.4.1.3 "><p id="p9806144365316"><a name="p9806144365316"></a><a name="p9806144365316"></a>0~2147483647</p>
</td>
</tr>
</tbody>
</table>


**表 15**  start参数

<a name="table45722029132319"></a>

<table><thead align="left"><tr id="row157214292236"><th class="cellrowborder" valign="top" width="44.67%" id="mcps1.2.3.1.1"><p id="p657332992311"><a name="p657332992311"></a><a name="p657332992311"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="55.33%" id="mcps1.2.3.1.2"><p id="p175731429182314"><a name="p175731429182314"></a><a name="p175731429182314"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row4904151813359"><td class="cellrowborder" valign="top" width="44.67%" headers="mcps1.2.3.1.1 "><p id="p190431873518"><a name="p190431873518"></a><a name="p190431873518"></a>--cm_arbitration_mode=ARBITRATION_MODE </p>
</td>
<td class="cellrowborder" valign="top" width="55.33%" headers="mcps1.2.3.1.2 "><p id="p2639256183818"><a name="p2639256183818"></a><a name="p2639256183818"></a>一主多备功能，获取cm_server的仲裁模式。共有MAJORITY、MINORITY两种模式，MAJORITY为多数派模式，MINORITY为少数派模式。少数派模式适用于一主多备数据库部署并且只有AZ3存活时，此时cm_server可以进行正常的仲裁业务，非此模式下将仲裁模式设置成少数派成功后，cm会自动将仲裁模式改为多数派，以保证集群正常运转；多数派模式适用于一主多备数据库部署并且各个组件（cm_server，节点）存活数量大于一半的场景。数据库实例正常情况下默认为多数派模式。</p>
<div class="caution" id="note1463910569387"><a name="note1463910569387"></a><a name="note1463910569387"></a><span class="cautiontitle"> 注意： </span><div class="cautionbody"><p id="p56391756113812"><a name="p56391756113812"></a><a name="p56391756113812"></a>openGauss不支持少数派</p>
</div></div>
</td>
</tr>
</tbody>
</table>


**表 16**  reload 参数

<a name="table11377594818"></a>

<table><thead align="left"><tr id="row191374598810"><th class="cellrowborder" valign="top" width="19.07%" id="mcps1.2.3.1.1"><p id="p81371759884"><a name="p81371759884"></a><a name="p81371759884"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="80.93%" id="mcps1.2.3.1.2"><p id="p51371359185"><a name="p51371359185"></a><a name="p51371359185"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row1613551115370"><td class="cellrowborder" valign="top" width="19.07%" headers="mcps1.2.3.1.1 "><p id="p125141917163710"><a name="p125141917163710"></a><a name="p125141917163710"></a>--param</p>
</td>
<td class="cellrowborder" valign="top" width="80.93%" headers="mcps1.2.3.1.2 "><p id="p1751513175372"><a name="p1751513175372"></a><a name="p1751513175372"></a>表明需要加载cm参数，不带此参数则不能执行加载cm参数。</p>
</td>
</tr>
<tr id="row11375597819"><td class="cellrowborder" valign="top" width="19.07%" headers="mcps1.2.3.1.1 "><p id="p7137959988"><a name="p7137959988"></a><a name="p7137959988"></a>--agent | --server</p>
</td>
<td class="cellrowborder" valign="top" width="80.93%" headers="mcps1.2.3.1.2 "><p id="p81379594820"><a name="p81379594820"></a><a name="p81379594820"></a>表明当前需要动态加载cm_server还是cm_agent的参数。</p>
</td>
</tr>
</tbody>
</table>


**表 17**  list参数

<a name="table0914920191018"></a>

<table><thead align="left"><tr id="row16914192061011"><th class="cellrowborder" valign="top" width="18.96%" id="mcps1.2.3.1.1"><p id="p1491413208107"><a name="p1491413208107"></a><a name="p1491413208107"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="81.04%" id="mcps1.2.3.1.2"><p id="p991415208109"><a name="p991415208109"></a><a name="p991415208109"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row10516627123718"><td class="cellrowborder" valign="top" width="18.96%" headers="mcps1.2.3.1.1 "><p id="p108223363717"><a name="p108223363717"></a><a name="p108223363717"></a>--param</p>
</td>
<td class="cellrowborder" valign="top" width="81.04%" headers="mcps1.2.3.1.2 "><p id="p082163319379"><a name="p082163319379"></a><a name="p082163319379"></a>此参数为必带参数，表明需要列出cm参数信息。</p>
</td>
</tr>
<tr id="row12914172051015"><td class="cellrowborder" valign="top" width="18.96%" headers="mcps1.2.3.1.1 "><p id="p1491442071016"><a name="p1491442071016"></a><a name="p1491442071016"></a>--agent | --server</p>
</td>
<td class="cellrowborder" valign="top" width="81.04%" headers="mcps1.2.3.1.2 "><p id="p1915320111019"><a name="p1915320111019"></a><a name="p1915320111019"></a>此参数为必带参数，表明当前需要查看cm_server还是cm_agent的参数。</p>
</td>
</tr>
</tbody>
</table>


**表 18**  encrypt参数

<a name="table4739105911382"></a>

<table><thead align="left"><tr id="row273916595382"><th class="cellrowborder" valign="top" width="17.61%" id="mcps1.2.3.1.1"><p id="p1740145913817"><a name="p1740145913817"></a><a name="p1740145913817"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="82.39%" id="mcps1.2.3.1.2"><p id="p87401459183813"><a name="p87401459183813"></a><a name="p87401459183813"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row77407599381"><td class="cellrowborder" valign="top" width="17.61%" headers="mcps1.2.3.1.1 "><p id="p16740165913389"><a name="p16740165913389"></a><a name="p16740165913389"></a>-M</p>
</td>
<td class="cellrowborder" valign="top" width="82.39%" headers="mcps1.2.3.1.2 "><p id="p127407599381"><a name="p127407599381"></a><a name="p127407599381"></a>指定加密类型，支持server、client。默认类型为server。</p>
</td>
</tr>
<tr id="row10308151616412"><td class="cellrowborder" valign="top" width="17.61%" headers="mcps1.2.3.1.1 "><p id="p203087164417"><a name="p203087164417"></a><a name="p203087164417"></a>-D</p>
</td>
<td class="cellrowborder" valign="top" width="82.39%" headers="mcps1.2.3.1.2 "><p id="p1330871613411"><a name="p1330871613411"></a><a name="p1330871613411"></a>指定生成的加密密码文件路径。</p>
</td>
</tr>
</tbody>
</table>


**表 19**  switch参数

<a name="table7591811163812"></a>

<table><thead align="left"><tr id="row116011120380"><th class="cellrowborder" valign="top" width="26.479999999999997%" id="mcps1.2.3.1.1"><p id="p960141133813"><a name="p960141133813"></a><a name="p960141133813"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="73.52%" id="mcps1.2.3.1.2"><p id="p156018113381"><a name="p156018113381"></a><a name="p156018113381"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row760411173813"><td class="cellrowborder" valign="top" width="26.479999999999997%" headers="mcps1.2.3.1.1 "><p id="p1860411173815"><a name="p1860411173815"></a><a name="p1860411173815"></a>--ddb_type=[DDB]</p>
</td>
<td class="cellrowborder" valign="top" width="73.52%" headers="mcps1.2.3.1.2 "><p id="p56091153816"><a name="p56091153816"></a><a name="p56091153816"></a>选择需要切换到哪个DDB模式（openGauss只支持DCC模式）。</p>
</td>
</tr>
<tr id="row0601511113819"><td class="cellrowborder" valign="top" width="26.479999999999997%" headers="mcps1.2.3.1.1 "><p id="p10601311203814"><a name="p10601311203814"></a><a name="p10601311203814"></a>--commit</p>
</td>
<td class="cellrowborder" valign="top" width="73.52%" headers="mcps1.2.3.1.2 "><p id="p12601811123819"><a name="p12601811123819"></a><a name="p12601811123819"></a>执行切换会使数据库实例无法选主，需要执行commit恢复数据库实例。</p>
</td>
</tr>
<tr id="row185952324012"><td class="cellrowborder" valign="top" width="26.479999999999997%" headers="mcps1.2.3.1.1 "><p id="p115922315400"><a name="p115922315400"></a><a name="p115922315400"></a>--rollback</p>
</td>
<td class="cellrowborder" valign="top" width="73.52%" headers="mcps1.2.3.1.2 "><p id="p195912239404"><a name="p195912239404"></a><a name="p195912239404"></a>回滚操作，执行切换失败需要执行回滚操作。</p>
</td>
</tr>
</tbody>
</table>



**表 20**  ddb参数

<a name="table9665145942617"></a>

<table><thead align="left"><tr id="row466525912618"><th class="cellrowborder" valign="top" width="24.26%" id="mcps1.2.3.1.1"><p id="p146651459142614"><a name="p146651459142614"></a><a name="p146651459142614"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="75.74%" id="mcps1.2.3.1.2"><p id="p4665185972619"><a name="p4665185972619"></a><a name="p4665185972619"></a>参数说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row116651859182617"><td class="cellrowborder" valign="top" width="24.26%" headers="mcps1.2.3.1.1 "><p id="p1966525920261"><a name="p1966525920261"></a><a name="p1966525920261"></a>--put [key] [value]</p>
</td>
<td class="cellrowborder" valign="top" width="75.74%" headers="mcps1.2.3.1.2 "><p id="p1366575916264"><a name="p1366575916264"></a><a name="p1366575916264"></a>往DCC中插入键值对，如果键值对已存在则会修改键key所对应的值value。</p>
</td>
</tr>
<tr id="row566545911263"><td class="cellrowborder" valign="top" width="24.26%" headers="mcps1.2.3.1.1 "><p id="p18665185932611"><a name="p18665185932611"></a><a name="p18665185932611"></a>--get [key]</p>
</td>
<td class="cellrowborder" valign="top" width="75.74%" headers="mcps1.2.3.1.2 "><p id="p9665175915268"><a name="p9665175915268"></a><a name="p9665175915268"></a>查询DCC中key对应的value。</p>
</td>
</tr>
<tr id="row15196652912"><td class="cellrowborder" valign="top" width="24.26%" headers="mcps1.2.3.1.1 "><p id="p619156132916"><a name="p619156132916"></a><a name="p619156132916"></a>--delete [key]</p>
</td>
<td class="cellrowborder" valign="top" width="75.74%" headers="mcps1.2.3.1.2 "><p id="p719168299"><a name="p719168299"></a><a name="p719168299"></a>删除DCC中指定的键值对。</p>
</td>
</tr>
<tr id="row8171152343111"><td class="cellrowborder" valign="top" width="24.26%" headers="mcps1.2.3.1.1 "><p id="p21711123123119"><a name="p21711123123119"></a><a name="p21711123123119"></a>--prefix</p>
</td>
<td class="cellrowborder" valign="top" width="75.74%" headers="mcps1.2.3.1.2 "><p id="p1117111239317"><a name="p1117111239317"></a><a name="p1117111239317"></a>get或者delete后添加prefix参数，可以实现模糊匹配查询和删除。</p>
</td>
</tr>
<tr id="row5306142533517"><td class="cellrowborder" valign="top" width="24.26%" headers="mcps1.2.3.1.1 "><p id="p030642553510"><a name="p030642553510"></a><a name="p030642553510"></a>--cluster_info</p>
</td>
<td class="cellrowborder" valign="top" width="75.74%" headers="mcps1.2.3.1.2 "><p id="p49771547103512"><a name="p49771547103512"></a><a name="p49771547103512"></a>获取数据库实例信息。</p>
</td>
</tr>
<tr id="row273185853512"><td class="cellrowborder" valign="top" width="24.26%" headers="mcps1.2.3.1.1 "><p id="p1174165853518"><a name="p1174165853518"></a><a name="p1174165853518"></a>--leader_info</p>
</td>
<td class="cellrowborder" valign="top" width="75.74%" headers="mcps1.2.3.1.2 "><p id="p17741258153514"><a name="p17741258153514"></a><a name="p17741258153514"></a>获取主节点信息。</p>
</td>
</tr>
<tr id="row1650133010324"><td class="cellrowborder" valign="top" width="24.26%" headers="mcps1.2.3.1.1 "><p id="p20511305328"><a name="p20511305328"></a><a name="p20511305328"></a>--help，-h</p>
</td>
<td class="cellrowborder" valign="top" width="75.74%" headers="mcps1.2.3.1.2 "><p id="p1051730113216"><a name="p1051730113216"></a><a name="p1051730113216"></a>显示DCC命令帮助信息。</p>
</td>
</tr>
<tr id="row560803311322"><td class="cellrowborder" valign="top" width="24.26%" headers="mcps1.2.3.1.1 "><p id="p106087332320"><a name="p106087332320"></a><a name="p106087332320"></a>--version，-v</p>
</td>
<td class="cellrowborder" valign="top" width="75.74%" headers="mcps1.2.3.1.2 "><p id="p5608113383215"><a name="p5608113383215"></a><a name="p5608113383215"></a>显示DCC版本信息。</p>
</td>
</tr>
</tbody>
</table>



### 命令参考<a name="section129433814222"></a>

- 启动实例：

  ```
  cm_ctl start [-z AVAILABILITY_ZONE [--cm_arbitration_mode=ARBITRATION_MODE]] | [-n NODEID [-D DATADIR]] [-t SECS]
  ```

- 数据库主备倒换：

  ```
  cm_ctl switchover [-z AVAILABILITY_ZONE] | [-n NODEID -D DATADIR [-f]] | [-a] | [-A] [-t SECS]
  ```

- 所有备机停止回放，每个分片中选择一个强制升主：

  ```
  cm_ctl finishredo
  ```

- 重建备节点：

  ```
  cm_ctl build -n NODEID -D DATADIR [-t SECS] [-f] [-b full]
  ```

- 检测实例进程运行状态：

  ```
  cm_ctl check -B BINNAME -T DATAPATH
  ```

- 停止实例：

  ```
  cm_ctl stop [[-z AVAILABILITY_ZONE] | [-n NODEID [-D DATADIR [-R]]]] [-t SECS] [-m SHUTDOWN-MODE]
  ```

- 查询集群状态：

  ```
  cm_ctl query [-z ALL] [-l FILENAME] [-v [-C [-s] [-S] [-d] [-i] [-F] [-x] [-p]] | [-r]] [-t SECS] [--minorityAz=AZ_NAME]
  ```

- 查看集群配置文件：

  ```
  cm_ctl view [-v | -N | -n NODEID] [-l FILENAME]
  ```

- 设置参数：

  ```
  cm_ctl set [--log_level=LOG_LEVEL] [--cm_arbitration_mode=ARBITRATION_MODE] [--cm_switchover_az_mode=SWITCHOVER_AZ_MODE]
  ```

- 设置CM参数：

  ```
  cm_ctl set --param --agent | --server [-n NODEID] -k "PARAMETER='value'"
  ```

- 获取参数：

  ```
  cm_ctl get [--log_level] [--cm_arbitration_mode] [--cm_switchover_az_mode]
  ```

- 设置DCF投票数：

  ```
  cm_ctl setrunmode -n NODEID -D DATADIR  [[--xmode=normal] | [--xmode=minority --votenum=NUM]]
  ```

- 改变dcf角色信息：

  ```
  cm_ctl changerole [--role=PASSIVE | --role=FOLLOWER] -n NODEID -D DATADIR [-t SECS]
  ```

- 改变dcf节点属性：

  ```
  cm_ctl changemember [--role=PASSIVE | --role=FOLLOWER] [--group=xx] [--priority=xx] -n NODEID -D DATADIR [-t SECS]
  ```

- 动态加载CM参数：

  ```
  cm_ctl reload --param [--agent | --server]
  ```

- 列出所有CM参数：

  ```
  cm_ctl list --param [--agent | --server]
  ```

- 加密：

  ```
  cm_ctl encrypt [-M MODE] -D DATADIR
  ```

- 执行DCC命令行：

  ```
  cm_ctl ddb DCC_CMD
  设置：cm_ctl ddb --put [key] [value]
  删除：cm_ctl ddb --delete [key]
  查看DCC命令帮助信息：cm_ctl ddb --help
  ```

- 执行switch ddb命令：

  ```
  cm_ctl switch [--ddb_type=[DDB]] [--commit] [--rollback]
  ```

## 安装和卸载工具介绍<a name="ZH-CN_TOPIC_0000001201210100"></a>

使用cm_install工具可以在未部署CM的openGauss数据库集群上部署CM，cm_uninstall可以在已部署CM的openGauss集群上卸载掉CM，且不会影响DN集群。  

### 注意事项

-   执行cm_install之后默认会启动集群。
-   需要以个人用户执行。
-   本工具允许在集群停止状态下进行安装或卸载CM工具，但是需要注意的是，集群停止之前的主应该为xml配置的初始主，否则安装或卸载CM工具后再次启动后集群的主机会与集群停止前的主机不一致。
-   如果是在集群停止状态下卸载CM工具，卸载后会删除动态文件，但是由于集群处于停止状态，所以无法生成，如果需要的话可以在gs_om启动集群后使用gs_om -t refreshconf命令重新生成即可。

### 前提条件

-   openGauss集群是通过OM工具安装的，需要有OM工具。
-   集群各节点之间存在互信，通常通过OM工具安装的集群就能够保证这一点。
-   待安装的openGauss集群的版本号与待安装的CM的版本号相同。
-   部署CM前集群状态需要为正常或停止，并且主机的term必须为非0值且为集群中最大。

### 使用方法

安装
```
cm_install -? | --help
cm_install -X XMLFILE [-e envFile] --cmpkg=cmpkgPath
```

卸载
```
cm_uninstall -? | --help
cm_uninstall -X XMLFILE [-e envFile] [--deleteData] [--deleteBinary]
```

**参数说明：**  

-   -X

    XML文件的路径。

-   -e

    环境变量文件的路径，默认值为"~/.bashrc"。

-   --cmpkg

    CM包的路径。

-   --deleteData

    删除CM数据目录，默认不删除。

-   --deleteBinary

    删除CM相关二进制，包括om_monitor、cm_agent、cm_server、cm_ctl，默认不删除。

-   -?, --help

    显示帮助信息。


## 安全设计<a name="ZH-CN_TOPIC_0000001201487108"></a>

### 手动替换证书步骤<a name="section103992017202219"></a>

- 创建自认证证书

  自认证证书生成请参考（开发者指南\>数据库安全管理\>客户端接入认证\>SSL证书管理\>证书生成\)。

  对私钥密码的保护，使用cm encrypt工具，请参考[cm\_ctl工具介绍](#ZH-CN_TOPIC_0000001201327140)。

  ```
  cm_ctl encrypt [-M MODE] -D DATADIR
  ```

  1. 生成服务器端密钥因子server.key.cipher、server.key.rand。

     ```
     cm_ctl encrypt -M server -D DATADIR
     please enter the password:（使用密码需要与服务器私钥的保护密码相同）
     ```

  2. 生成客户端密钥因子client.key.cipher、client.key.rand。

     ```
     cm_ctl encrypt -M client -D DATADIR
     please enter the password:（使用密码需要与客户端私钥的保护密码相同）
     ```



### 证书使用指南<a name="section10534952182617"></a>

1. 使用证书需配置cm\_server参数为on \(默认关闭\)，

   ```
   cm_ctl set --param --server -k enable_ssl="on"
   ```


1. 证书文件需要存在于所有节点的$GAUSSHOME/share/sslcert/cm中，证书替换后重启集群生效。

   所需证书文件：server.crt、server.key、client.crt、client.key、cacert.pem、server.key.cipher、server.key.rand、client.key.cipher、client.key.rand

   根证书、密钥、证书以及密钥密码加密文件的权限，需保证权限为400。如果权限不满足要求，则无法使用ssl。

   -   chmod 400 cacert.pem
   -   chmod 400 server.crt
   -   chmod 400 server.key
   -   chmod 400 server.key.cipher
   -   chmod 400 server.key.rand
   -   chmod 400 client.crt
   -   chmod 400 client.key
   -   chmod 400 client.key.cipher
   -   chmod 400 client.key.rand

2. 证书有效期的检测周期为1天，可通过ssl\_cert\_expire\_check\_interval设置。证书有效期剩余90天时会开始产生告警，可通过[ssl\_cert\_expire\_alert\_threshold](#ssl\_cert\_expire\_alert\_threshold<a name="section8148443183416"></a>)设置。

## CM配置参数介绍<a name="ZH-CN_TOPIC_0000001201167154"></a>

cm\_agent相关参数可通过cm\_agent数据目录下的cm\_agent.conf文件查看，cm\_server相关参数可通过cm\_server数据目录下的cm\_server.conf文件查看。

### cm\_agent参数<a name="ZH-CN_TOPIC_0000001246246987"></a>

####  log\_dir<a name="section030711438392"></a>

**参数说明：**log\_dir决定存放cm\_agent日志文件的目录。 可以是绝对路径，或者是相对路径（相对于$GAUSSLOG的路径）。通过cm\_ctl设置绝对路径时需要将路径用''把路径包含起来，例如：cm\_ctl set --param --agent -k log\_dir="'/log/dir'"。

**取值范围：**字符串，最大长度为1024。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**“log”，表示在$GAUSSLOG下对应的cm目录下生成cm\_agent日志。

#### log\_file\_size<a name="section130710434392"></a>

**参数说明：**控制日志文件的大小。当'cm\_agent-xx-current.log'日志文件达到指定大小时，则重新创建一个日志文件记录日志信息。

**取值范围：**整型，\[0, 2047\]，实际生效范围\[1, 2047\]，单位：MB。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**16MB。

#### log\_min\_messages<a name="section19307194343914"></a>

**参数说明：**控制写到cm\_agent日志文件中的消息级别。每个级别都包含排在它后面的所有级别中的信息。级别越低，服务器运行日志中记录的消息就越少。

**取值范围：**枚举类型，有效值有debug5、debug1、warning、error、log、fatal（不区分大小写）。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**warning

#### incremental\_build<a name="section330784317397"></a>

**参数说明：**控制重建备节点模式是否为增量。打开这个开关，则增量重建备节点；否则，全量重建备节点。

**取值范围：**布尔型。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   on、yes、true、1：表示增量重建备节点。

-   off、no、false、0：表示全量重建备节点。

**默认值：**on

#### security\_mode<a name="section318914113417"></a>

**参数说明：**控制是否以安全模式启动节点。打开这个开关，则以安全模式启动节点；否则，以非安全模式启动节点。

**取值范围：**布尔型。修改后可以动态生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   on、yes、true、1：表示以安全模式启动节点。

-   off、no、false、0：表示以非安全模式启动节点。

**默认值：**off

#### upgrade\_from<a name="section616511291250"></a>

**参数说明：**就地升级过程中使用，用于标示升级前数据库的内部版本号，此参数禁止手动修改。

**取值范围：**非负整型，\[0, 4294967295\]。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**0

#### alarm\_component<a name="section19308174317397"></a>

**参数说明：**在使用第一种告警方式时，设置用于处理告警内容的告警组件的位置。通过cm\_ctl设置绝对路径时需要将路径用''把路径包含起来，例如：cm\_ctl set --param --agent -k alarm\_component="'/alarm/dir'"。

**取值范围：**字符串，最大长度为1024。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**/opt/huawei/snas/bin/snas\_cm\_cmd

#### alarm\_report\_interval<a name="section17308104393914"></a>

**参数说明：**指定告警上报的时间间隔。

**取值范围：**非负整型，\[0, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**1

#### agent\_heartbeat\_timeout<a name="section1222151611711"></a>

**参数说明：**cm\_server心跳超时时间。

**取值范围：**整型，\[2, 2147483647\]，单位：秒。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**5

#### agent\_connect\_timeout<a name="section13943381675"></a>

**参数说明：**cm\_agent连接cm\_server超时时间。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**1

#### agent\_connect\_retries<a name="section184312403713"></a>

**参数说明：**cm\_agent连接cm\_server尝试次数。

**取值范围：**整型，\[0, 2147483647\]。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**15

#### agent\_kill\_instance\_timeout<a name="section10806122512811"></a>

**参数说明：当**cm\_agent在无法连接cm\_server主节点后，发起一次杀死本节点上所有实例的操作之前，所需等待的时间间隔。

**取值范围：**整型，\[0, 2147483647\]。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**0，不发起杀死本节点上所有实例的操作。

#### agent\_report\_interval<a name="section1740211461789"></a>

**参数说明：**cm\_agent上报实例状态的时间间隔。

**取值范围：**整型，\[0, 2147483647\]。单位：秒。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**1

#### alarm\_report\_max\_count<a name="section490373917911"></a>

**参数说明：**指定告警上报的最大次数。

**取值范围：**非负整型，\[1, 2592000\]。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**1

#### agent\_check\_interval<a name="section296010163916"></a>

**参数说明：**cm\_agent查询实例状态的时间间隔。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**2

#### enable\_log\_compress<a name="section18961713161017"></a>

**参数说明**：控制压缩日志功能。

**取值范围**：布尔型。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   on、yes、true、1：表示允许压缩日志。
-   off、no、false、0：表示不允许压缩日志。

**默认值**：on

#### process\_cpu\_affinity<a name="section1740823111111"></a>

**参数说明：**控制是否以绑核优化模式启动主节点进程。配置该参数为0，则不进行绑核优化；否则，进行绑核优化，且物理CPU片数为2<sup>n</sup>个。数据库、cm\_agent重启生效。仅支持ARM。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**取值范围：**整型，\[0, 2\]。

**默认值：**0

#### enable\_xc\_maintenance\_mode<a name="section154040531117"></a>

**参数说明：**在数据库为只读模式下，控制是否可以修改pgxc\_node系统表。

**取值范围：**布尔型。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   on、yes、true、1：表示开启可以修改pgxc\_node系统表功能。

-   off、no、false、0：表示关闭可以修改pgxc\_node系统表功能。

**默认值：**on

#### log\_threshold\_check\_interval<a name="section1372141912128"></a>

**参数说明**：cm日志压缩和清除的时间间隔，每1800秒压缩和清理一次。

**生效范围**：$GAUSSLOG/cm/cm\_ctl；$GAUSSLOG/cm/cm\_server；$GAUSSLOG/cm/om\_monitor目录下的文件以及$GAUSSLOG/cm/cm\_agent目录下以cm\_agent-、system\_call-、system\_alarm-为前缀的日志文件。

**取值范围**：整型，\[0, 2147483647\]，单位：秒。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：1800

#### log\_max\_size<a name="section1940221415131"></a>

**参数说明**：控制cm日志最大存储值，当CM日志总大小超过（log\_max\_size\*95/100）MB时，根据压缩日志生成时间，依次删除历史压缩日志，直到日志总大小小于（log\_max\_size\*95/100）MB。

**生效范围**：$GAUSSLOG/cm/cm\_ctl；$GAUSSLOG/cm/cm\_server；$GAUSSLOG/cm/om\_monitor目录下的文件以及$GAUSSLOG/cm/cm\_agent目录下以cm\_agent-、system\_call-、system\_alarm-为前缀的日志文件。

**取值范围**：整型，\[0, 2147483647\]，单位：MB。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：10240

#### log\_max\_count<a name="section114033146138"></a>

**参数说明**：cm可存储的最多日志数量，当cm日志总个数超过该值，根据压缩日志文件名时间，删除超过保留天数log\_saved\_days的压缩日志。

**生效范围**：$GAUSSLOG/cm/cm\_ctl；$GAUSSLOG/cm/cm\_server；$GAUSSLOG/cm/om\_monitor目录下的文件以及$GAUSSLOG/cm/cm\_agent目录下以cm\_agent-、system\_call-、system\_alarm-为前缀的日志文件。

**取值范围**：整型，\[0, 10000\]，单位：个。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：10000

#### log\_saved\_days<a name="section25051814181410"></a>

**参数说明**：cm压缩日志保存的天数，cm压缩日志超过该值并且cm日志总个数超过log\_max\_count，删除压缩日志。

**生效范围**：$GAUSSLOG/cm/cm\_ctl；$GAUSSLOG/cm/cm\_server；$GAUSSLOG/cm/om\_monitor目录下的文件以及$GAUSSLOG/cm/cm\_agent目录下以cm\_agent-、system\_call-、system\_alarm-为前缀的日志文件。

**取值范围**：整型，\[0, 1000\]，单位天。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：90

#### agent\_phony\_dead\_check\_interval<a name="section13310143113916"></a>

**参数说明：**cm\_agent检测进程是否僵死的时间间隔。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**10

#### unix\_socket\_directory<a name="section931094316393"></a>

**参数说明：**unix套接字的目录位置。通过cm\_ctl设置绝对路径时需要将路径用''把路径包含起来，例如：cm\_ctl set --param --agent -k unix\_socket\_directory="'/unix/dir'"。

**取值范围：**字符串，最大长度为1024。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：** ''

#### dilatation\_shard\_count\_for\_disk\_capacity\_alarm<a name="section827183713151"></a>

**参数说明**：扩容场景下，设置新增的扩容分片数，用于上报磁盘容量告警时的阈值计算。

**取值范围**：整型，\[0, 2147483647\]，单位：个。该参数设置为0，表示关闭磁盘扩容告警上报；该参数设置为大于0，表示开启磁盘扩容告警上报，且告警上报的阈值根据此参数设置的分片数量进行计算。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：1

#### enable\_dcf<a name="section8310843173919"></a>

**参数说明**：DCF模式开关。

**取值范围**：布尔型。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   on、yes、true、1：表示启用dcf。
-   off、no、false、0：表示不启用dcf。

**默认值**：off

#### disaster\_recovery\_type<a name="section1027633115186"></a>

**参数说明**：主备数据库灾备关系的类型。

**取值范围**：整型，\[0, 2\]。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   0表示未搭建灾备关系。
-   1表示搭建了obs灾备关系。
-   2表示搭建了流式灾备关系

**默认值**：0

#### agent\_backup\_open<a name="section114001741152513"></a>

**参数说明**：灾备模式设置，开启后CM按照灾备模式运行。

**取值范围**：整型，\[0, 2\]。修改后需要重启cm\_agent才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   0表示未搭建灾备关系。
-   1表示搭建了obs灾备关系（之后不再支持）。
-   2表示搭建了流式灾备关系。

**默认值**：0

#### enable\_fence\_dn<a name="section114001741152513"></a>

**参数说明**：cm\_agent连不上任何除了自身节点的cms,并且自身节点cms不是Primary时，设置是否重启datanode进程。

**取值范围**：布尔型。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   on、yes、true、1：表示重启datanode进程。

-   off、no、false、0：表示不重启datanode进程。

**默认值：**

### cm\_server参数<a name="ZH-CN_TOPIC_0000001246287001"></a>

#### log\_dir<a name="section21021611134413"></a>

**参数说明：**log\_dir决定存放cm\_server日志文件的目录。 它可以是绝对路径，或者是相对路径（相对于$GAUSSLOG的路径）。通过cm\_ctl设置绝对路径时需要将路径用''把路径包含起来，例如：cm\_ctl set --param --server -k log\_dir="'/log/dir'"。

**取值范围：**字符串，最大长度为1024。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**“log”，表示在$GAUSSLOG下对应的cm目录下生成cm\_server日志。

#### log\_file\_size<a name="section171021311114411"></a>

**参数说明：**控制日志文件的大小。当'cm\_server-xx-current.log'日志文件达到指定大小时，则重新创建一个日志文件记录日志信息。

**取值范围：**整型，\[0, 2047\]，实际生效范围\[1, 2047\]，单位：MB。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**16MB

#### log\_min\_messages<a name="section1110261111441"></a>

**参数说明：**控制写到cm\_server日志文件中的消息级别。每个级别都包含排在它后面的所有级别中的信息。级别越低，服务器运行日志中记录的消息就越少。

**取值范围：**枚举类型，有效值有debug5、debug1、log、warning、error、fatal（不区分大小写）。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**warning

#### thread\_count<a name="section12102111113443"></a>

**参数说明：**cm\_server线程池的线程数。

**取值范围：**整型，\[2, 1000\]。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**1000

#### instance\_heartbeat\_timeout<a name="section24821313171815"></a>

**参数说明：**实例心跳超时时间。

**取值范围：**整型，\[1, 2147483647\]，单位：秒。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](cm_ctl工具介绍.md#table10437204416514)进行设置。

**默认值：**6

#### instance\_failover\_delay\_timeout<a name="section14533832212"></a>

**参数说明：**cm\_server检测到主机宕机，failover备机的延迟时间。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**0

#### cmserver\_ha\_connect\_timeout<a name="section3103711174420"></a>

**参数说明：**cm\_server主备连接超时时间。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**2

#### cmserver\_ha\_heartbeat\_timeout<a name="section1510361114443"></a>

**参数说明：**cm\_server主备心跳超时时间。

**取值范围：**整型，\[1, 2147483647\]，单位：秒。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**6

#### cmserver\_ha\_status\_interval<a name="section1133674182316"></a>

**参数说明：**cm\_server主备同步状态信息间隔时间。

**取值范围：**整型，\[1, 2147483647\]，单位：秒。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**1

#### cmserver\_self\_vote\_timeout<a name="section363915452213"></a>

**参数说明：**cm\_server之间相互投票的超时时间。旧版本遗留参数，实际不生效。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：6**

#### phony\_dead\_effective\_time<a name="section11031311164411"></a>

**参数说明：**用于数据库节点僵死检测，当检测到的僵死次数大于该参数值，认为进程僵死，将进程重启。

**取值范围：**整型，\[1, 2147483647\]，单位：次数。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**5

#### cm\_server\_arbitrate\_delay\_base\_time\_out<a name="section9923154532414"></a>

**参数说明：**cm\_server仲裁延迟基础时长。cm\_server主断连后，仲裁启动计时开始，经过仲裁延迟时长后，将选出新的cm\_server主。其中仲裁延迟时长由仲裁延迟基础时长、节点index（server ID序号）和增量时长共同决定。公式为：仲裁延迟时长=仲裁延迟基础时长+节点index\*仲裁延迟增量时长参数。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**10

#### cm\_server\_arbitrate\_delay\_incrememtal\_time\_out<a name="section116431649142414"></a>

**参数说明：**cm\_server仲裁延迟增量时长。cm\_server主断连后，仲裁启动计时开始，经过仲裁延迟时长后，将选出新的cm\_server主。其中仲裁延迟时长由仲裁延迟基础时长、节点index（server ID序号）和增量时长共同决定。公式为：仲裁延迟时长=仲裁延迟基础时长+节点index\*仲裁延迟增量时长参数。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**3

#### alarm\_component<a name="section12321745182515"></a>

**参数说明：**在使用第一种告警方式时，设置用于处理告警内容的告警组件的位置。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。通过cm\_ctl设置绝对路径时需要将路径用''把路径包含起来，例如：cm\_ctl set --param --server -k alarm\_component="'/alarm/dir'"。

**取值范围：**字符串，最大长度为1024。修改后需要重启cm\_server才能生效。

**默认值：**/opt/huawei/snas/bin/snas\_cm\_cmd

#### alarm\_report\_interval<a name="section17967105912515"></a>

**参数说明：**指定告警上报的时间间隔。

**取值范围：**非负整型，\[0, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**3

#### alarm\_report\_max\_count<a name="section183101620262"></a>

**参数说明：**指定告警上报的最大次数。

**取值范围：**非负整型，\[1, 2592000\]。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**1

#### instance\_keep\_heartbeat\_timeout<a name="section1092193510262"></a>

**参数说明：**cm\_agent会定期检测实例状态并上报给cm\_server，若实例状态长时间无法成功检测，累积次数超出该数值，则cm\_server将下发命令给agent重启该实例。

**取值范围：**整型，\[0, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**40

#### az\_switchover\_threshold<a name="section10442115810268"></a>

**参数说明：**若一个AZ内节点分片的故障率（故障的节点分片数 / 总节点分片数 \* 100%）超过该数值，则会触发AZ自动切换。

**取值范围：**整型，\[1, 100\]。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**100

#### az\_check\_and\_arbitrate\_interval<a name="section208296015278"></a>

**参数说明：**当某个AZ状态不正常时，会触发AZ自动切换，该参数是检测AZ状态的时间间隔。

**取值范围：**整型，\[1, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**2

#### az\_connect\_check\_interval<a name="section182125018279"></a>

**参数说明：**定时检测AZ间的网络连接，该参数表示连续两次检测之间的间隔时间。

**取值范围：**整型，\[1, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**60

#### az\_connect\_check\_delay\_time<a name="section1884134782719"></a>

**参数说明：**每次检测AZ间的网络连接时有多次重试，该参数表示两次重试之间的延迟时间**。**

**取值范围：**整型，\[1, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**150

#### cmserver\_demote\_delay\_on\_etcd\_fault<a name="section171253502814"></a>

**参数说明：**因为etcd不健康而导致cm\_server从主降为备的时间间隔**。**

**取值范围：**整型，\[1, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**8

#### instance\_phony\_dead\_restart\_interval<a name="section938462914288"></a>

**参数说明：**当数据库实例僵死时，会被cm\_agent重启，相同的实例连续因僵死被杀时，其间隔时间不能小于该参数数值，否则cm\_agent不会下发命令**。**

**取值范围：**整型，\[1800, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**21600

#### enable\_transaction\_read\_only<a name="section510515117445"></a>

**参数说明：**控制数据库是否为只读模式开关。

**取值范围：**布尔型，有效值有on，off，true，false，yes，no，1，0。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**on

#### datastorage\_threshold\_check\_interval<a name="section122858817307"></a>

**参数说明**：检测磁盘占用的时间间隔。间隔时间由用户指定，表示检测一次磁盘的间隔时间。

**取值范围**：整型，\[1, 2592000\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：10

#### datastorage\_threshold\_value\_check<a name="section121051111164418"></a>

**参数说明：**设置数据库只读模式的磁盘占用阈值，当数据目录所在磁盘占用超过这个阈值，自动将数据库设置为只读模式。

**取值范围：**整型，\[1, 99\]。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**85

#### max\_datastorage\_threshold\_check<a name="section1710519119443"></a>

**参数说明：**设置磁盘使用率的最大检测间隔时间。当用户手动修改只读模式参数后，会自动在指定间隔时间后开启磁盘检测操作。

**取值范围：**整型，\[1, 2592000\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**43200

#### enable\_az\_auto\_switchover<a name="section14105161104415"></a>

**参数说明：**AZ自动切换开关，若打开，则表示允许cm\_server自动切换AZ。否则当发生节点故障等情况时，即使当前AZ已经不再可用，也不会自动切换到其他AZ上，除非手动执行切换命令。

**取值范围：**非负整型，0或1，0：开关关闭，1：开关打开。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**1

#### cm\_krb\_server\_keyfile<a name="section815763211440"></a>

**参数说明：**kerberos服务端key文件所在位置，需要配置为绝对路径。该文件通常为$\{GAUSSHOME\}/kerberos路径下，以keytab格式结尾，文件名与集群运行所在用户名相同。与上述cm\_auth\_method参数是配对的，当cm\_auth\_method参数修改为gss时，该参数也必须配置为正确路径，否则将影响集群状态。通过cm\_ctl设置绝对路径时需要将路径用''把路径包含起来，例如：cm\_ctl set --param --server -k cm\_krb\_server\_keyfile="'/krb/dir'"。

**取值范围：**字符串类型，修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**$\{GAUSSHOME\}/kerberos/\{UserName\}.keytab，默认值无法生效，仅作为提示。

#### switch\_rto<a name="section489193815352"></a>

**参数说明：**cm\_server强起逻辑等待时延。在force\_promote被置为1时，当集群的某一分片处于无主状态开始计时，等待该延迟时间后开始执行强起逻辑。

**取值范围：**整型，\[60, 2147483647\]，单位：秒。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**600

#### force\_promote<a name="section210571111441"></a>

**参数说明：**cm\_server是否打开强起逻辑（指集群状态为Unknown的时候以丢失部分数据为代价保证集群基本功能可用）的开关。0代表功能关闭，1代表功能开启。

**取值范围：**整型，\[0, 1\]。在cm\_server上修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**0

#### backup\_open<a name="section51185261313"></a>

**参数说明**：灾备集群设置，开启后CM按照灾备集群模式运行。

**取值范围**：整型，\[0, 1\]。修改后需要重启cm\_server才能生效。非灾备集群不能开启该参数。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   0表示关闭。
-   1表示开启

**默认值**：0

#### enable\_dcf<a name="section1223164233119"></a>

**参数说明**：DCF模式开关。

**取值范围**：布尔型。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

-   on、yes、true、1：表示启用dcf。
-   off、no、false、0：表示不启用dcf。

**默认值**：off

#### ddb\_type<a name="section0106121124418"></a>

**参数说明**：ETCD，DCC模式切换开关。

**取值范围**：整型。0：ETCD；1：DCC。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：1

> ![](public_sys-resources/icon-note.gif) **说明：** 
>
> openGauss仅支持DCC模式。

#### enable\_ssl<a name="section1910621118445"></a>

**参数说明**：ssl证书开关。

**取值范围**：布尔型。打开后使用ssl证书加密通信。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：

- on、yes、true、1：表示启用ssl。

- off、no、false、0：表示不启用ssl。

- **默认值**：off

  >![](public_sys-resources/icon-notice.gif) **须知：** 
  >出于安全性考虑，建议不要关闭该配置。关闭后cm将**不使用**加密通信，所有信息明文传播，可能带来窃听、篡改、冒充等安全风险。


#### ssl\_cert\_expire\_alert\_threshold<a name="section8148443183416"></a>

**参数说明**：ssl证书过期告警时间。

**取值范围**：整型，\[7, 180\]，单位：天。证书过期时间少于该时间时，上报证书即将过期告警。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：90

#### ssl\_cert\_expire\_check\_interval<a name="section10149843143417"></a>

**参数说明**：ssl证书过期检测周期。

**取值范围**：整型，\[0, 2147483647\]，单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：86400

#### ddb\_log\_level<a name="section181071211184411"></a>

**参数说明**：设置DDB日志级别。

关闭日志：“NONE”，NONE表示关闭日志打印，不能与以下日志级别混合使用。

开启日志：“RUN\_ERR|RUN\_WAR|RUN\_INF|DEBUG\_ERR|DEBUG\_WAR|DEBUG\_INF|TRACE|PROFILE|OPER”日志级别可以从上述字符串中选取字符串并使用竖线组合使用，不能配置空串。

**取值范围**：字符串，RUN\_ERR|RUN\_WAR|RUN\_INF|DEBUG\_ERR|DEBUG\_WAR|DEBUG\_INF|TRACE|PROFILE|OPER。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：RUN\_ERR|RUN\_WAR|DEBUG\_ERR|OPER|RUN\_INF|PROFILE

#### ddb\_log\_backup\_file\_count<a name="section610761194419"></a>

**参数说明**：最大保存日志文件个数。

**取值范围**：整型，\[1, 100\]。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：10

#### ddb\_max\_log\_file\_size<a name="section19107101110446"></a>

**参数说明**：单条日志最大字节数。

**取值范围**：字符串，长度最大为1024，\[1M, 1000M\]。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：10M

#### ddb\_log\_suppress\_enable<a name="section11071411114412"></a>

**参数说明**：是否开启日志抑制功能。

**取值范围**：整型，0：关闭； 1：开启。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：1

#### ddb\_election\_timeout<a name="section1096185711575"></a>

**参数说明**：DCC 选举超时时间。

**取值范围**：整型，\[1, 600\], 单位：秒。修改后可以reload生效，参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：3

#### delay\_arbitrate\_timeout<a name="section1410893910156"></a>

**参数说明**：设置等待跟主DN同AZ节点redo回放，优先选择同AZ升主的时间。

**取值范围**：整型，\[0, 2147483647\]，单位：秒。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值**：0

#### cm\_auth\_method<a name="section1969815428196"></a>

**参数说明：**CM模块端口认证方式，trust表示未配置端口认证，gss表示采用kerberos端口认证。必须注意的是：只有当kerberos服务端和客户端成功安装后才能修改为gss，否则CM模块无法正常通信，将影响数据库状态。

**取值范围：**枚举类型，有效值有trust, gss。修改后需要重启cm\_server才能生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置。

**默认值：**trust

## dn\_arbitrate\_mode<a name="section1264174324416"></a>

**参数说明**：DN仲裁模式。

**取值范围**：字符串。修改后可以reload生效。参数修改请参考[表 set cm参数](#table10437204416514)进行设置，share\_disk模式下，不建议用户修改仲裁模式。

-   quorum
-   paxos
-   share\_disk

**默认值**：quorum