# 录制回放

## 功能特性介绍

1. DataKit录制回放支持录制MySQL客户端的业务SQL，然后在openGauss端进行回放。回放结果会输出慢SQL信息和失败SQL信息。

2. 录制回放工具具体介绍，请参考[录制回放工具](../../../DataMigrationGuide/录制回放工具.md)。

> 使用前提条件：
>
> 1.录制回放时需要源端和目标端的数据一致，所以需要先使用迁移工具同步源端数据到目标端。
>
> 2.使用“实例管理”导入数据库实例或者集群管理导入集群实例作为源端和目标端数据库。

## 1.创建录制回放任务

点击【创建录制回放任务】进入创建页面。

![录制回放1.png](figures/录制回放1.png)

填写源端和目标端数据库信息和配置项信息（配置项信息如果没有特别大的数据量，无需进行配置，使用默认值就好）。

![录制回放2.png](figures/录制回放2.png)

![录制回放3.png](figures/录制回放3.png)

配置完成后点击【保存】即可。

![录制回放4.png](figures/录制回放4.png)

记得配置ip地址对应的网卡名，之后点击【提交】，即可创建任务成功。

![录制回放5.png](figures/录制回放5.png)

如图是创建的任务，状态是”未执行“。

![录制回放6.png](figures/录制回放6.png)

点击【执行任务】，任务状态变为“执行中”，此时在源端执行的SQL都会被录制到并在目标端进行回放。

录制回放的三种模式的全部介绍参考以下链接：

https://gitee.com/opengauss/compatibility-assessment/tree/master/dynamic_sql_collection/transcribe-replay-tool

具体录制操作和设置的参数有关，参数含义请参考上面的链接。

![录制回放7.png](figures/录制回放7.png)

![录制回放8.png](figures/录制回放8.png)

点击任务名称可以查看录制回放结果，即“录制回放详情页面”（慢SQL、失败SQL、SQL在源端和目标端的耗时对比）。

![录制回放9.png](figures/录制回放9.png)

## 2.录制回放详情

如果源端存在业务，目标端回放时，详情页面会显示已解析数据、已回放数据、慢SQL、失败SQL、耗时对比，如下示例：

慢SQL展示归一化SQL语句、源端耗时、目的端耗时、出现次数。

![录制回放12.png](figures/录制回放10.png)

失败SQL展示在目的端执行失败的SQL语句以及失败原因。

![录制回放13.png](figures/录制回放11.png)

红色曲线代表源端数据库，绿色曲线代表目标端数据库，横坐标代表录制到的SQL的ID，纵坐标代表SQL执行耗时（单位：微秒）。

![录制回放14.png](figures/录制回放12.png)
