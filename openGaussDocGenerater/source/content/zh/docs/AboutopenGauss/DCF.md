# DCF

## 可获得性<a name="section15406143204715"></a>

本特性自openGauss 2.0.0版本开始引入。

## 特性简介<a name="section740615433477"></a>

DCF（Distributed Consensus Framework，分布式共识框架）基于Paxos算法实现数据同步强一致。DCF模式开关开启后，DN可以支持基于Paxos协议的复制与仲裁能力。

## 客户价值<a name="section13406743164715"></a>

DN基于Paxos的自选主及日志复制，复制过程中支持压缩及流控，防止带宽占用过高。使用DCF可以提供日志复制、集群高可用等能力。DCF提供了自选主能力，支持少数派强起能力，日志复制支持动态流量调整。同时也提供了基于Paxos多种角色节点类型，并能进行调整。支持查询当前数据库实例的状态。

DCF是一款高性能、高度成熟可靠、易扩展、易使用的独立基础库，其他系统通过接口与DCF简单对接，就能够轻松拥有Paxos算法赋予的强一致、高可用、自动容灾等能力。

## 特性描述<a name="section16406154310471"></a>

-   DCF进行日志复制时，支持对日志进行压缩后再传输，减小对网络带宽的占用。
-   DCF支持SSL，包括TLS1.2和TLS1.3协议标准。当开启SSL时，DN默认将DCF配置为TLS1.2协议标准。
-   DCF支持5种TLS1.3的密码套件：TLS13-AES-256-GCM-SHA384、TLS13-CHACHA20-POLY1305-SHA256、TLS13-AES-128-GCM-SHA256、TLS13-AES-128-CCM-8-SHA256、TLS13-AES-128-CCM-SHA256。
-   DCF支持passive角色节点类型，passive节点不参与选举，只做日志的同步以及回放，该类型节点在高负载的情况下，日志同步会做流控。
-   DCF支持logger角色节点，logger节点可以参与选举和投票，但是只复制DCF的日志，不复制xlog，不进行redo。
-   DCF的follower和passive角色可以在线互换，即不中断业务的情况下，follower角色的节点转化为passive角色，passive角色的节点转化为follower。
-   DCF支持少数派强起能力，在数据库实例多数派故障的情况下，从正常的备DN中选择少数派模式强启成为主DN，其余正常的备DN从主DN复制日志。
-   DCF支持自选主能力，在原主DN故障的场景下，在保证数据一致性的前提下，剩余备DN自动选出新的主DN。
-   DCF支持策略化多数派能力，以多数派为前提，同时根据用户配置的AZ，保证AZ内至少有一个节点同步复制日志。
-   DCF支持手动模式，在手动模式下不自动仲裁，此模式下对接上层CM等管理组件做仲裁适配，DCF进行日志复制功能。 
-   支持DCF日志与DN日志合一存储，DCF多数派达成和DN仅存储一份日志，减少IO带宽占用，日志合一后日志刷盘的IO开销比两份日志下降20%+，优化性能。
-   支持从Quorum模式切换到DCF模式，以及从DCF模式恢复到Quorum模式。切换过程中不需要重启数据库，做到数据不丢失，不影响业务。

## 特性增强<a name="section1340684315478"></a>

无。

## 特性约束<a name="section06531946143616"></a>

若使用此功能，DN最少三节点，在安装部署阶段需要开启DCF开关。在DCF模式下通过多数派选举，安装过程中如果故障节点数加build节点数达到多数派会导致集群安装失败，如在安装一主两备时，安装过程中一节点因内存不足导致安装失败，另外两节点正常启动，但随后备机会进行一次build，这时build节点加故障节点为2，达到多数派会导致集群安装失败，请在安装过程中检查内存和磁盘等资源是否充足。

若某个AZ配置了策略化多数派参数，当AZ内所有的节点均故障后，在对节点执行build相关的操作时，需要将该AZ配置从策略化多数派配置信息中移除。

与Quorum相比，DCF模式不支持的功能有：
   1. 不支持双集群容灾（不支持级联备） 
   2. 不支持已有Quorum复制到DCF复制模式的在线升级 
   3. 不支持备机读 
   4. 不支持第三方仲裁（CM仲裁）
   5. 不支持自动降副本 
   6. 不支持增量build

## 依赖关系<a name="section8406643144716"></a>

无。

